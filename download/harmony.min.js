/*! Harmony v0.1pre Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(i,ha,s){function Ja(e,c){for(var a in c)e[a]||(e[a]=c[a])}function pb(e){return"."===e?"#":ua(e.length+2).join("#")}function Ka(e){if(e===D)return"";var c=La.exec(e);return c?c[1].replace(va,wa):e}function wa(e){return"#"==e?".":ua(e.length).join("#")}function xa(e,c,a){var b,d=e.lastIndexOf(".");j(a)&&(a=!0);if(a){-1===d?(a="",b=e):(a=e.substring(0,d),b=e.substring(d+1));for(var d=a,a=b,f=0;f<Q.length;f++)Q[f](d,a,c)}if(!H(c))for(b in c){for(var d=e,a=b,f=c[b],h=0;h<Q.length;h++)Q[h](d,
a,f);xa(e+"."+b,c[b],!1)}}function Ma(e,c){var c=E(c),a=I[c];a||(I[c]=a=[]);a.pushUnique(e)}function Na(e,c){var c=E(c),a=I[c];a.remove(e);a.length||delete I[c]}function Oa(e){return(e=qb.exec(e))&&e[1]||""}function ia(){return!1}function x(){return!0}function ja(e,c,a,b,d){this.publisher=J(e);this.originalPublisher=J(c);this.originalType=this.type=a;this.proposed=b;this.removed=d}function Pa(e){var c=e.workflow,a=c.getName,c=c.getParas,e=e.publisher;return c?e[a](c):p(e[a])?e[a]():e[a]}function Qa(e,
c){var a=c.workflow,b=a.setName;(a=a.setParas)?this[b](a,e):p(this[b])?this[b](e):this[b]=e}function Ra(e,c,a){var b=R.getId(c);return i.map(e.split(S),function(c){return m(a)?c+"."+D+"."+b+"."+a:c+"."+D+"."+b+"."+R.getId(a)}).join(" ")}function J(e){return m(e)?g(e):e==T?null:r(e)&&!e.nodeType?e:i(e)}function rb(e){return"."==e?"\\.":".*"}function Sa(e){var c,a,b;b=e.publisher.subsToMe();for(a=0;a<b.length;a++){c=b[a];var d=e,f;a:{f=c.eventTypes;var h=e.type,g=void 0,i=void 0,j=i=g=void 0,k=void 0;
if("*"===f)f="*";else{f=f.split(S);for(k=0;k<f.length;k++)if(i=f[k],i=(j=Ta.test(i))?i.replace(Ta,""):i,i=i.replace(sb,rb),i=j?"^"+i:"^"+i+"$",g=new y(i),g=g.test(h))if(j){if(j="^"==i?h:y.rightContext,!j||!j.contains(".")){f=f[k];break a}}else{f=f[k];break a}f=void 0}}d.matchedType=f;e.matchedType&&ka(J(c.subscriber),c.workflow,e);if(e.isImmediatePropagationStopped())return}if(!e.isCascadeStopped()&&(c=I[e.publisher.path]))for(b=0;b<c.length;b++){a=o(c[b],e.originalPublisher.path,e.type);if(a.isImmediatePropagationStopped()||
a.isImmediatePropagationStopped())break;a.hasError()&&e.error()}}function ka(e,c,a,b){var d;a.workflow=c;a.subscriber=e;b=j(b)?c.get.call(e,a):c.get.apply(e,[a].concat(b));N(b)?(d=k(!0,{},a),b.done(function(b){c.convert&&(b=c.convert.call(e,b,a));if(!j(b))if(N(b))b.done(function(a){la(e,c,a,d)});else return la(e,c,b,a)})):(c.convert&&(b=c.convert.call(e,b,a)),j(b)||(N(b)?(d=k(!0,{},a),b.done(function(a){la(e,c,a,d)})):la(e,c,b,a)))}function la(e,c,a,b){j(a)||(c.set&&c.set.call(e,a,b),c.finalize&&
c.finalize.call(e,a,b))}function U(e){e.publisher=J(e.currentTarget);e.originalPublisher=J(e.target);var c=J(e.data.subscriber),a=e.data.workflow;delete e.data;1<arguments.length?ka(c,a,e,q.call(arguments,1)):ka(c,a,e)}function Ua(e,c,a,b){e=e||"";if(m(e)){var d,f=e.split(S),h;if(1==f.length)if(e.startsWith("*")){d=V[e.substr(1)];if(!d)throw"common workflow "+e+" does not exist";d=k({},d)}else if(e.startsWith("#")?(d=e.substr(1),d=m(a)?z(a,d):m(c)?z(c,d):d,d=n.raw(d)):d=void 0,d)if(p(d))d=k({get:d,
options:b},d);else if(r(d)&&d.get)d=k({options:b},d);else throw"missing handler";else if(!j(c)&&!j(a)){d=m(c);f=m(a);if(d)e={get:"get",set:e||"set"};else if(f)if(e)e={get:e,set:"set"};else if(e=n.raw(a),p(e))e={get:n.raw(a)};else{if(!r(e)||!e.get)throw"missing handler";}else e={get:e,set:e};d=e}else throw"invalid handler";else{d={};for(var i=0;i<ma.length;i++)e=f[i],h=ma[i],e&&("_"!==e&&"null"!=e)&&(d[h]=e)}e=d}else if(p(e))e=k({get:e,options:b},e);else if(r(e)&&e.get)e=k({options:b},e);else throw"invalid workflow expression";
d=e;f=d.initialize;if(m(f))if(f.startsWith("*")){if(f=g.activity.initialize[f.substring(1)],!f)throw"initialize activity does not exist!";}else{var u=f;if(!n.raw(u))throw"initialize activity does not exist at path "+u;f=function(a,b,c,d){n.set(u,a,b,c,d)}}f?(f(J(c),J(a),d,b),delete d.initialize):j(b)||(d.options=b);na("get",e,c,a);na("set",e,c,a);ca(e,"convert");ca(e,"finalize");return e}function Va(e){var c;if(m(e)){var a=e.split(S),b;if(1<a.length)for(var e={},d=0;d<ma.length;d++)c=a[d],b=ma[d],
c&&("_"!==c&&"null"!=c)&&(e[b]=c);else throw"invalid workflow type";c=e}else if(p(e)||r(e)&&e.get)c=e,p(e)&&(c=k({get:e},c));else throw"invalid workflow expression";ca(c,"initialize");na("get",c);na("set",c);ca(c,"convert");ca(c,"finalize");return c}function na(e,c,a,b){var d=c[e];if(d&&m(d)){var f=g.activity[e];if(d.startsWith("*")){if(d=d.substr(1),c[e]=f[d],!c[e])throw d+" does not exists "+e+" Activity";}else if(d=d.split("*"),c[e]="get"==e?Pa:Qa,c[e+"Name"]=d[0],d[1]&&(c[e+"Paras"]=d[1]),!j(a)&&
!j(b)){var c=d[0],a="get"==e?a:b,h;m(a)?F[c]||(h=!0):a.nodeType?W[c]||(h=!0):c in a||(h=!0);if(h)throw("get"==e?"publisher":"subscriber")+" does not have a member "+c;}}}function ca(e,c){var a=e[c];if(m(a))if(a.startsWith("*")){if(e[c]=g.activity[c][a.substr(1)],!e[c])throw a+"Activity does not exists";}else e[c]=function(){return n.raw(a).apply(this,arguments)}}function Wa(e){if(r(e)){if(!R.getId(e))return;R.unMark(e)}A.removeBy(e)}function ya(e,c){if("_"!==c)return c&&c.startsWith("_")?c.substr(1):
e||c}function L(e,c,a,b){var d,f;if(e)if(e.nodeType){if(b=e,e=i.trim(i(b).attr(l.subsAttr))){c=new L;c.elem=b;a=c;a:{for(b=i(b);(b=b.parent())&&b.length;)if(d=b.hmData("ns"),!j(d)){b=d;break a}b=""}a.ns=b;return new L(e,c)}}else{if(!c)return c=new L,c.elem={},new L(e,c);this.sub=[];this.pub=[];for(this.groups=[];f=tb.exec(e);){var h=f[1],g=f[2];f=f[3];var u={key:g,value:f};h?this["$"==h?"pub":"sub"].push(u):"ns"==g?d=f:this.groups.push(u)}this.ns=z(z(c.ns,a),d);this.text=e;this.elem=c.elem;this.subscriptions=
c.subscriptions;c.elemGroup?this.elemGroup=c.elemGroup:(this.elemGroup=this,i(this.elem).hmData("ns",this.ns));this.options=ya(c.options,b);this.importGroup();this.importSubscriptions("sub");this.importSubscriptions("pub");this.debug&&this.print()}else this.subscriptions=[]}function za(e){var c,a,b,d=i(e);if(!d.hmData("parsed")&&d.attr(l.subsAttr)){e=new L(e);c=e.subscriptions;e.preSub&&e.preSub();for(a=0;a<c.length;a++)b=c[a],g.sub(b.subscriber,b.publisher,b.eventTypes,b.handler,b.options,b.delegate);
e.postSub&&e.postSub();d.hmData("parsed",!0)}d.children().each(function(){za(this)})}function X(e,c,a){return k({},Aa,r(e)?e:{get:e,set:c,finalize:a})}function Xa(e){this.modelPath=e.publisher.path;this.e=e}function Ya(e){e=e||B.defaultEngine;if(!e)throw"engine name is not specified or default engine name is null";e=oa[e];if(!e)throw"engine '"+e+"' can not be found.";return e}function Za(e){e=e[0];return"true"==e.value?!0:"false"==e.value?!1:"on"!==e.value?e.value:e.checked}function $a(e,c,a,b){a:{var d,
f;if(a)for(d=Y.length-1;0<=d;d--){if(f=Y[d],f.name==a){a=f;break a}}else for(d=Y.length-1;0<=d;d--)if(f=Y[d],f.match&&f.match(e)){a=f;break a}a=void 0}if(!a||!a[b])throw"can not find "+b+" method for view";c[b+"ViewValue"]=a[b];a.convert&&(c.convert=a.convert);e.hmData("valueBound")||(a.initialize&&a.initialize(e),e.hmData("valueBound",!0))}function ub(e){var c=this.path,e=e.originalPublisher.path,a=e.substr(c.length+1),b=a.indexOf("."),c=c+"."+a.substr(0,b)+".__state";e!==c&&g.get(c)==v.unchanged&&
g.set(c,v.modified)}function pa(e,c){var a=e.get();return a.constructor[c](a).done(function(){e.set("__state","destroy"==c?v.detached:v.unchanged);e.trigger("afterSync."+c)})}function ab(e){if(""===e)return!da.length;for(var c=e+".",a=0,b,d=da.length;a<d;a++)if(b=da[a],b==e||b.startsWith(c))return!1;return!0}function Z(e,c){return c?function(a){return!e.test(a)}:function(a){return e.test(a)}}function M(e,c){return c.error||e.supplant(c)}function bb(e){var c=g(e+"*errors");c.isEmpty()||(c.clear(),
qa.removeItem(e))}function vb(e){return{initialize:e.initialize,get:function(c){var a,b,d=c.publisher;a=c.workflow.options;var f=c.proposed;c=e.name&&l.errors[e.name];if(e.buildError)c=e.buildError(c,a);else var h=r(a)?a.error:a,c=c&&c.contains("{0}")?c.format.apply(c,h.split(",")):h||c||e.error;if(null===f||f===s||cb.test(f)){a:{a=g(d.path).subsToMe();for(f=0;f<a.length;f++)if(a[f].workflow.get===wb){a=!0;break a}a=!1}a?(a=!1,b=!0):a=!0}else a=e.isValid(f,a);a?d.removeError(c):!b||"required"===e.name?
d.addError(c):d.removeError(c)}}}function db(e,c){for(var a=g.subscription.getAll(),b={},d=a.length-1,f,h;0<=d;d--)f=a[d],h=f.publisher,m(h)&&(!b[h]&&h.startsWith(e)&&f.eventTypes.contains("checkValidity"))&&(b[h]=!0,c(h))}function xb(e){var c;c=e.publisher;if(1===e.level){c=c.get().table;for(var a in c)if(c[a]==e.removed){this.set(a,e.proposed);break}}else if(2<=e.level){a=e.originalPublisher.path.substr(c.path.length+1);var b=a.substr(0,a.indexOf("."));i.isNumeric(b)&&(a="table."+c.keyAt(b)+a.substr(a.indexOf(".")),
c.trigger(a,"afterUpdate",e.proposed,e.removed))}}function yb(e){this.set("c"+e.publisher.get().guid++,e.proposed)}function zb(e){var c=this.get(),e=e.removed,a;for(a in c)if(c[a]===e){this.del(a);break}}function Ab(e){this.removeItem(e.removed)}function Bb(e){this.replaceItem(e.removed,e.proposed)}function Ba(e){this.selectedIndex=e}function eb(e){this.set(e.publisher.attr(e.workflow.options));e.preventDefault();e.stopPropagation()}var g=ha.hm=function(e,c){return new Ca(e,c)},Ca=function(e,c){this.path=
E(e||"",!0);j(c)||this.set(c)},F,k=i.extend,Da={},w=i.isArray,p=i.isFunction,Cb={undefined:s,"boolean":s,number:s,string:s},D="__hm",La=/^__hm\.([^\.]+?)(?:\.|$)/,Db=/this\.(?:get)\s*\(\s*(['"])([\*\.\w\/]+)\1\s*\)/g,I={},l={},n,K=Da[D]={},Eb=Da.hasOwnProperty,ua=ha.Array,fb=ua.prototype,Fb=String.prototype,q=fb.slice,o,Gb=/^(?:\{.*\}|\[.*\])$/,Hb=/^\.(\.*)([\.\*])/,Ib=/^\.<(.*)/,gb=/^[\.\*]/,Jb=/[\.\*]/,Kb=/#+|\./g,va=/#+/g,y=ha.RegExp,qb=/^(.+)[\.\*]\w+$/,z,Lb=/^.+\.(\w+)$|\w+/,G,j,H,m,r,$,Ea=i.isNumeric,
N,ea,E,C,Fa,W=i.fn,aa,Mb=/\{([^\{\}]*)\}/g;Ja(fb,{indexOf:function(e,c){for(var a=c||0;a<this.length;a++)if(this[a]==e)return a;return-1},contains:function(e){return-1!==this.indexOf(e)},remove:function(e){e=this.indexOf(e);-1!=e&&this.splice(e,1);return this},removeAt:function(e){this.splice(e,1);return this},pushUnique:function(e){this.contains(e)||this.push(e);return this},merge:function(e){if(e&&e.length)for(var c=0;c<e.length;c++)this.pushUnique(e[c]);return this},sortObject:function(e,c){j(c)&&
(j(e)?(c=!0,e=s):m(e)?c=!0:(c=e,e=s));e?this.sort(function(a,b){var d=a[e],f=b[e];return d==f?0:c?d>f?1:-1:d>f?-1:1}):c?this.sort():this.sort().reverse();return this}});Ja(Fb,{startsWith:function(e){return 0===this.indexOf(e)},contains:function(e){return-1!==this.indexOf(e)},endsWith:function(e){return-1!==this.indexOf(e,this.length-e.length)},supplant:function(e){return this.replace(Mb,function(c,a){var b=e[a];return typeof b?b:c})},format:function(){var e=this;i.each(arguments,function(c,a){e=e.replace(new y("\\{"+
c+"\\}","g"),a)});return e}});F=Ca.prototype=g.fn=g.prototype={constructor:Ca,get:function(e){var c;if(c=this.accessor(e,!0)){if(p(c.hostObj))return c.hostObj.apply(this.cd(".."),q.call(arguments));c=!c.index?c.hostObj:c.hostObj[c.index];return p(c)?c.apply(this.cd(e).cd(".."),q.call(arguments,1)):c}},getJson:function(){return JSON.stringify(this.get.apply(this,q.call(arguments)))},raw:function(e,c){var a;p(e)&&(c=e,e="");if(c)return a=this.accessor(e),a.index in a.hostObj?this.update(e,c,a):this.create(e,
c,a);if(a=this.accessor(e,!0))return!a.index?a.hostObj:a.hostObj[a.index]},set:function(e,c,a){if(1==arguments.length){if(""==this.path)throw"root object can not changed";n.set(this.path,e,c);return this}var b=q.call(arguments);if($(e)){if(2==arguments.length)return n.set(e,this.path,c),this}else a=c,c=e,e=!1;var d=this.accessor(c),f=d.hostObj[d.index];return p(f)?(f.apply(this.cd(c).cd(".."),q.call(b,1)),this):d.index in d.hostObj?this.update(e,c,a,d):this.create(e,c,a,d)},accessor:function(e,c){0===
e&&(e="0");var a,b,d=Da,f=this.getPath(e),h=E(f,!0),g=h.split(".");if(1===g.length)b=h;else{b=g[g.length-1];for(a=0;a<g.length-1&&!(d=d[g[a]],d===s);a++);}if(H(d)){if(c)return;throw"invalid update on unreachable node '"+C(f)+"'";}return{physicalPath:h,hostObj:d,index:b}},create:function(e,c,a,b){$(e)||(b=a,a=c,c=e,e=!1);var b=b||this.accessor(c),c=b.physicalPath,d=b.hostObj,f=b.index,h=w(d);if(h&&Ea(f)){if(f>d.length)throw"you can not add item with hole in array";}else if(f in d)throw"value at path: '"+
C(b.physicalPath)+"' has been defined, try use update method instead";if(!e&&o(c,c,"beforeCreate",a).hasError())return!1;h&&Ea(f)?f==d.length?d[f]=a:f<d.length&&d.splice(b.index,0,a):d[b.index]=a;o(c,c,"afterCreate",a);xa(c,a);return this},extend:function(e,c){var a;c?a=this.cd(e):(c=e,a=this);for(var b in c)a.set(b,c[b]);return this},update:function(e,c,a,b){if(1==arguments.length){if(""==this.path)throw"root object can not updated";n.update(this.path,e);return this}if($(e)){if(2==arguments.length)return n.update(e,
this.path,c),this}else b=a,a=c,c=e,e=!1;b=b||this.accessor(c);if(!(b.index in b.hostObj))throw"value at path: '"+C(b.physicalPath)+"' has been not defined, try use create method instead";var d=b.physicalPath,f=b.hostObj[b.index];if(f==a)return this;if(!e&&o(d,d,"beforeUpdate",a,f).hasError())return!1;b.hostObj[b.index]=a;e||o(d,d,"afterUpdate",a,f);xa(d,a);return this},del:function(e){if(j(e)){if(this.path)return n.del(this.path);throw"root can not be deleted";}var c=this.accessor(e),a=c.hostObj,
e=c.physicalPath,b=a[c.index],d=w(a);if(o(e,e,"beforeDel",s,b).hasError())return!1;d?a.splice(c.index,1):delete a[c.index];for(c=0;c<ra.length;c++)ra[c](e,b);o(e,e,"afterDel",s,b);return b},createIfUndefined:function(e,c){if(j(c))throw"missing value argument";var a=this.accessor(e);return a.index in a.hostObj?this:this.create(e,c,a)},pushStack:function(e){e.previous=this;return e},cd:function(e){return this.pushStack(g(this.getPath(e)))},parent:function(){return this.cd("..")},shadow:function(){return this.cd("*")},
sibling:function(e){return this.cd(".."+e)},main:function(){return this.pushStack(g(Ka(this.path)))},getPath:function(e){return z(this.path,e)},logicalPath:function(e){return C(this.getPath(e))},physicalPath:function(e){return E(this.getPath(e))},pathContext:function(){return Oa(this.path)},pathIndex:function(){var e=Lb.exec(this.path);return e[1]||e[0]},invoke:function(e){if(0===arguments.length)throw"methodName is missing";var c=this.get();return c[e].apply(c,q.call(arguments,1))},indexOf:function(e){return this.get().indexOf(e)},
contains:function(e){return-1!==this.indexOf(e)},first:function(e){return e?this.filter(e)[0]:this.get("0")},last:function(){var e=this.get();return e[e.length-1]},push:function(e){return this.create(this.get().length,e)},pushRange:function(e){for(var c=0;c<e.length;c++)this.push(e[c]);return this},pushUnique:function(e){return!this.contains(e)?this.push(e):this},pop:function(){return this.removeAt(this.get().length-1)},shift:function(){return this.del(0)},unshift:function(e){return this.create(0,
e)},insertAt:function(e,c){return this.create(e,c)},updateAt:function(e,c){return this.update(e,c)},removeAt:function(e){return this.del(e)},move:function(e,c){var a=this.count();e!==c&&(0<=e&&e<a&&0<=c&&c<a)&&(a=this.del(e),this.insertAt(c,a),o(this.path,this.path,"move",c,e));return this},replaceItem:function(e,c){if(e==c)return this;var a=this.indexOf(e);return-1!=a?this.updateAt(a,c):this},removeItem:function(e){e=this.indexOf(e);return-1!==e?this.removeAt(e):this},removeItems:function(e){for(var c=
0;c<e.length;c++)this.removeItem(e[c]);return this},clear:function(){var e=this.get(),c=e.splice(0,e.length);o(this.path,this.path,"afterCreate",e,c);return this},count:function(){return this.get().length},filter:function(e){return i(this.get()).filter(e).get()},each:function(e,c){$(e)||(c=e,e=!1);var a,b,d,f;if(e){f=this.get();for(b=f.length-1;0<=b;b--)if(d=c(b,f[b],f),!0===d)a=!0;else if(!1===d)break;a&&this.triggerChange()}else for(b=this.count()-1;0<=b&&!(a=this.cd(b),!1===c.call(a,b,a,this));b--);
return this},map:function(e){return i.map(this.get(),e)},sort:function(e,c){return o(this.path,this.path,"afterUpdate",this.get().sortObject(e,c))},reference:function(){for(var e=0;e<arguments.length;e++)Ma(this.path,arguments[e]);return this},dereference:function(){for(var e=0;e<arguments.length;e++)Na(this.path,arguments[e]);return this},isEmpty:function(e){e=this.get(e);return!e?!0:!w(e)?!1:0===e.length},isShadow:function(){return this.path.startsWith(D)},toJSON:function(e){return JSON.stringify(this.get(e))},
compare:function(e){if(e)if(e=ea(e),m(e)){if(this.get()==e)return!0;try{return eval("this.get()"+e)}catch(c){return!1}}else return this.get()==e;else return this.isEmpty()},saveLocal:function(e){G.local(this.getPath(e),this.get());return this},getLocal:function(e){return G.local(this.getPath(e))},restoreLocal:function(e){n.set(this.getPath(e),this.getLocal(e));return this},clearLocal:function(e){G.local(this.getPath(e),s);return this}};var Q=[function(e,c,a){if(p(a)&&(!a.name||!a.name.startsWith("_"))){for(var c=
e?e+"."+c:c,b=a.toString(),d,a=[];d=Db.exec(b);)a.pushUnique(d[2]);for(b=0;b<a.length;b++)Ma(c,e?z(e,a[b]):a[b])}}],T={},Ga=function c(a){var b;if(!(this instanceof c))return b=new c(T),c.apply(b,arguments);if(arguments[0]===T)return this;this.initialize.apply(this,arguments);return this},ba;k(Ga.prototype,{callProto:function(c){return this.constructor.prototype[c].apply(this,q.call(arguments,1))},callBase:function(c){ba=ba||this;if(ba=ba.constructor.__super__){var a=ba[c].apply(this,q.call(arguments,
1));ba=null;return a}},initialize:function(c){k(this,c)},toJSON:function(){var c=k(!0,{},this),a;for(a in c)a.startsWith("__")&&delete c[a];return c}});k(Ga,{list:function(c){var a,b,d=[],f;if(!j(c))if(w(c)){f=c.itemIsObject;for(a=0;a<c.length;a++)b=c[a],d.push(f||!w(b)?new this(b):this.apply(null,b))}else d.push(c);return d},extend:function(c,a){var b,d=this;b=c&&c.hasOwnProperty("constructor")?c.constructor:function t(){var a;if(!(this instanceof t))return a=new t(T),t.apply(a,arguments);if(arguments[0]===
T)return this;d.apply(this,arguments);return this};k(b,d,a);var f=function(){this.constructor=b};f.prototype=d.prototype;b.prototype=new f;c&&k(b.prototype,c);b.__super__=d.prototype;return b}});k(g,{Class:Ga,util:G={toPhysicalPath:E=function(c,a){for(var b,d="",f="",h;b=Jb.exec(c);)c=y.rightContext,f=y.leftContext,"."==b[0]?d?(d==D&&(a&&!K[f])&&(h=f.replace(va,wa),j(n.get(h))||(K[f]={})),d=d+"."+f):d=f:(d?(b=(d?d.replace(Kb,pb):d)+"#"+f,h=d+"."+f):h=f?b=f:b="",d=D+(b?"."+b:""),a&&(!K[b]&&d!=D&&!j(n.get(h)))&&
(K[b]={}));return!c?d:d?d+"."+c:c},toLogicalPath:C=function(c){var a;return c===D?"*":(a=La.exec(c))?(c=y.rightContext,a=a[1].replace(va,wa),C(a+"*"+c)):c},mergePath:z=function(c,a,b){if("_"==a||"_"==c)return"_";c=E(c);if(!j(a)&&null!==a&&(a+="",a.startsWith("/")))return a.substr(1);j(b)&&(b=!0);b&&(a&&c&&!gb.test(a))&&(a="."+a);if(!a||"."==a)return c;if(gb.test(a)){if(b=Hb.exec(a)){for(var a=1+(b[1]?b[1].length:0),d=y.rightContext;a;)c=Oa(c),a--;return d?c?c+b[2]+d:d:"*"===b[2]?c+"*":c}if(b=Ib.exec(a))return z(Ka(c),
b[1])}else return a;return c+a},isUndefined:j=function(c){return c===s},isPrimitive:H=function(c){return null===c||typeof c in Cb},isString:m=function(c){return"string"===typeof c},isObject:r=function(c){return"object"===i.type(c)},isBoolean:$=function(c){return"boolean"===typeof c},toTypedValue:ea=function(c){if(m(c)){c=i.trim(c);try{c="true"===c?!0:"false"===c?!1:"null"===c?null:"undefined"===c?s:Ea(c)?parseFloat(c):Gb.test(c)?i.parseJSON(c):c}catch(a){}}return c},isPromise:N=function(c){return!(!c||
!c.promise||!c.done||!c.fail)},clearObj:Fa=function(c){if(H(c))return null;for(var a in c)Eb.call(c,a)&&(c[a]=Fa(c[a]));return c},clone:aa=function(c,a){return H(c)?c:w(c)?c.slice(0):p(c)?c:k(!!a,{},c)},local:function(c,a){if(1==arguments.length)return JSON.parse(localStorage.getItem(c));j(a)?localStorage.removeItem(c):localStorage.setItem(c,JSON.stringify(a))},toString:function(c){return null===c||c===s?"":""+c},encodeHtml:function(c){var a=document.createElement("div");a.appendChild(document.createTextNode(c));
return a.innerHTML},_referenceTable:I},onAddOrUpdateNode:function(c){return c?(Q.push(c),this):Q},onDeleteNode:function(c){return c?(ra.push(c),this):ra},options:l});var ra=[function(c){var a,b,d=C(c);for(a in I)Na(c,a);for(a in I)a.startsWith(c)&&delete I[a];for(b in K)c=D+"."+b,a=C(c),(a==d||a.startsWith(d+"*")||a.startsWith(d+"."))&&n.del(c)}];i(["get","set","del","extend"]).each(function(c,a){g[a]=function(){return n[a].apply(n,q.call(arguments))}});n=g();W.hmData=function(c,a){var b=this.data("hmData");
if(0===arguments.length)return b;if(1===arguments.length)return b&&b[c];j(b)&&this.data("hmData",b={});b[c]=a};var V,S=/[ ]+/,Ta=/\*\.$/,sb=/\.|\*/g,A,Nb=0,Ob=/init(\d*)/,ma=["get","set","convert","finalize","initialize"];ja.prototype={constructor:ja,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=x},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=
x},stopCascade:function(){this.isCascadeStopped=x},error:function(){this.hasError=x},isCascadeStopped:ia,isPropagationStopped:ia,isImmediatePropagationStopped:ia,hasError:ia,level:0};o=function(c,a,b,d,f){d=new ja(c,a,b,d,f);Sa(d);if(!d.isPropagationStopped()&&d.publisher.path){d.isDependent()&&(d.originalPublisher.path=d.publisher.path);do d.publisher.path=d.publisher.pathContext(),d.level++,d.type=d.originalType+"."+d.level,Sa(d);while(!d.isPropagationStopped()&&d.publisher.path)}d.type=b;d.originalPublisher.path=
a;d.publisher.path=c;return d};var Ha=function(c,a){m(c)&&(c=E(c));for(var b=[],d=0,f;d<O.length;d++)f=O[d],a(f,c)&&b.push(f);return b},O=[];A={getByPublisher:function(c){return Ha(c,function(a,b){return a.publisher==b})},getBySubscriber:function(c){return Ha(c,function(a,b){return a.subscriber==b})},getBy:function(c){return Ha(c,function(a,b){return a.subscriber==b||a.publisher==b})},getAll:function(){return O},add:function(c,a,b,d){if(m(a))for(var f=b.split(S),h=0;h<f.length;h++){var g=this.special[f[h]];
g&&g.setup&&g.setup(c,a)}O.push({publisher:a,subscriber:c,eventTypes:b,workflow:d})},removeBy:function(c){var a,b,d,f=[];for(a=O.length-1;0<=a;a--)if(d=O[a],b=d.workflow,c===d.publisher||c===d.subscriber||m(c)&&(m(d.publisher)&&d.publisher.startsWith(c+".")||m(d.subscriber)&&d.subscriber.startsWith(c+".")))m(d.publisher)||(b.delegateSelector?i(d.publisher).undelegate(b.delegateSelector,d.eventTypes,U):i(d.publisher).unbind(d.eventTypes,U)),f.push(O.splice(a,1)[0]);for(a=f.length-1;0<=a;a--)if(d=f[a],
m(d.publisher))for(var h=d.eventTypes.split(S),c=0;c<h.length;c++)(b=this.special[h[c]])&&b.teardown&&b.teardown(d.subscriber,d.publisher)},special:{}};k(g,{trigger:o,subscription:A,sub:function(c,a,b,d,f,h){c instanceof g&&(c=c.path);a instanceof g&&(a=a.path);m(c)&&c.startsWith("$")&&(c=i(c.substr(1)));if(c&&c.jquery)if(!c.length&&!c.selector)c=null;else{c.each(function(c,i){g.sub(i,a,b,d,f,h)});return}m(a)&&a.startsWith("$")&&(a=i(a.substr(1)));if(a&&a.jquery)a.each(function(a,i){g.sub(c,i,b,d,
f,h)});else{if(!a&&""!==a)throw"publisher can not be null";if(!b)throw"eventTypes can not be null";if("_"===c||"null"==c||null===c)c=T;"_"===f&&(f=s);var t=m(a),u=m(c);R.mark(a);R.mark(c);t&&(a=E(a));u&&(c=E(c));if(t){var j=a,k=b,n=c,t=f,l,p,r,o;o=k.split(" ");for(var q=0;q<o.length;q++)if(u=Ob.exec(o[q])){p=o[q];l=+u[1];o.splice(q,1);k=o.join(" ");break}r=Ua(d,j,n,t);k&&A.add(n,j,k,r);p&&(k=function(){var a=new ja(j,j,p);ka(J(n),r,a)},l?setTimeout(k,l):k())}else(l=a,t=b,u=c,o=f,q=t.split(" "),q.contains("init")&&
(k=!0,t=q.remove("init").join(" ")),q=Ua(d,l,u,o),o={workflow:q,subscriber:u},t)?(t=Ra(t,l,u),h?(q.delegateSelector=h,i(l).delegate(h,t,o,U)):i(l).bind(t,o,U),A.add(u,l,t,q),k&&(h?i(l).find(h).trigger(t):i(l).trigger(t))):k&&(i(l).one("init",o,U),i(l).trigger("init"))}},handle:function(){return this.sub.apply(this,[null].concat(q.call(arguments)))},workflowType:function(c,a){if(r(c))for(var b in c)V[b]=Va(c[b]);else return j(c)?V:j(a)?V[c]:V[c]=Va(a)},activity:{initialize:{},get:{getMember:Pa,getOriginal:function(c){return c.originalPublisher.get()},
skipGet:x},set:{setMember:Qa,skipSet:i.noop},convert:{toString:G.toString,toTypedValue:G.toTypedValue,toNumber:function(c){return+c},toDate:function(c){return new Date(c)}},finalize:{}}});V={triggerChange:{get:function(c){n.triggerChange(c.workflow.options)}},saveLocal:{get:function(c){var a=c.publisher.path;setTimeout(function(){g(a).saveLocal()},1)}}};var R={getId:function(c){return i(c).hmData("viewId")},unMark:function(c){i(c).hmData("viewId",s)},mark:function(c){r(c)&&!i(c).hmData("viewId")&&
i(c).hmData("viewId",++Nb)}};g.onDeleteNode(Wa);k(F,{trigger:function(c,a,b,d){if(!arguments.length)throw"missing arguments";3>=arguments.length&&(d=b,b=a,a=c,c="");var f=this.physicalPath(c);o(f,f,a,b,d);return this},triggerChange:function(c){var a=this.physicalPath(c),c=this.get(c);o(a,a,"afterUpdate",c,c);return this},sub:function(c,a,b,d,f){g.sub(this.path,c,a,b,d,f);return this},handle:function(c,a,b,d){g.sub(null,this,c,a,b,d);return this},subBy:function(c,a,b,d,f){g.sub(c,this.path,a,b,d,f);
return this},subsToMe:function(){return A.getByPublisher(this.path)},subsFromMe:function(){return A.getBySubscriber(this.path)},subscriptions:function(){return A.getBy(this.path)},mapEvent:function(c,a,b){b=b||x;g.handle(this.path,c,function(c){b.call(this,c)&&c.publisher.trigger(a,c.proposed,c.removed)});return this},cacheable:function(c){g.handle(this.getPath(c),"init after*","*saveLocal");return this}});k(W,{sub:function(c,a,b,d,f){this.length&&g.sub(this,c,a,b,d,f);return this},handle:function(c,
a,b,d){this.length&&g.sub(null,this,c,a,b,d);return this},subBy:function(c,a,b,d,f){this.length&&g.sub(c,this,a,b,d,f);return this},subsToMe:function(){return A.getByPublisher(this[0])},subsFromMe:function(){return A.getBySubscriber(this[0])},subscriptions:function(){return A.getBy(this[0])},initView:function(c,a,b){g.sub(this,c,"init",a,b);return this},mapEvent:function(c,a,b,d){b?p(b)||(d=b,b=x):b=x;return this.handle(c,function(c){if(b.call(this,c)){c.type=a;c.eventData=d;c.publisher.trigger(c)}})}});
g.newViewEvent=function(c,a,b){if(r(c)){for(var d in c)g.newViewEvent(d,c[d][0],c[d][1]);return this}var f=function(a){(!0===b||b.call(this,a))&&i(a.target).trigger(k({},a,{type:c,currentTarget:a.target}))};if(i.event.special[c])throw"event '"+c+"' has been defined";i.event.special[c]={setup:function(){i(this).bind(a,f)},teardown:function(){i(this).unbind(a,f)}};return this};var Pb=i.cleanData;i.cleanData=function(c){i(c).each(function(){Wa(this)});Pb(c)};G.getUniqueViewEventTypes=Ra;G._viewHandlerGateway=
U;var tb=/([!$]?)([\w \+\-\*\.]+?):([\w\W]+?)\s*(?:[;]\s*|$)/g,Qb=/^([^|]+)(\|(.*))?$/,Rb=/\s*\|\s*/g;l.subsAttr="data-sub";l.autoparseSub=!0;L.prototype={importGroup:function(){var c,a,b,d,f=this.groups;for(c=0;c<f.length;c++)b=f[c],a=b.key,d=Qb.exec(b.value),b=d[1],d=d[3],a=g.groups[a],p(a)?a(this.elem,z(this.ns,b),this,ya(this.options,d)):m(a)&&new L(a,this,b,d)},importSubscriptions:function(c){var a,b,d,f,h,g=this[c];for(a=0;a<g.length;a++)b=g[a],f=b.key,b=b.value.split(Rb),"sub"==c?(d=b[0],d=
d.startsWith("$")?d:z(this.ns,d),h=this.elem):(d=this.elem,h=b[0],h=h.startsWith("$")?h:z(this.ns,h)),this.appendSub(h,d,f,b[1],ea(ya(this.options,b[2])),b[3])},appendSub:function(c,a,b,d,f,h){this.subscriptions.push({publisher:a,eventTypes:b,subscriber:c,handler:d,options:f,delegate:h})},prependSub:function(c,a,b,d,f,h){this.subscriptions.unshift({publisher:a,eventTypes:b,subscriber:c,handler:d,options:f,delegate:h})},clearSubs:function(){this.subscriptions.splice(0,this.subscriptions.length)}};
setTimeout(function(){i(function(){l.autoparseSub&&za(document.documentElement)})},1);W.parseSub=function(){return this.each(function(){za(this)})};var hb=g("*log",[]);k(g,{groups:{code:function(c,a,b,d){n.get(a,c,a,b,d)},preSub:function(c,a,b,d){b.preSub=function(){n.get(a,c,a,b,d)}},postSub:function(c,a,b,d){b.postSub=function(){n.get(a,c,a,b,d)}}},Group:L,log:function(c,a){hb.push(a?"<div style='color:"+a+"'>"+c+"</div> ":c)},clearlog:function(){hb.clear()}});var B,oa={},Aa={initialize:"*templateOptions",
get:"get",convert:"*dataToMarkup",set:"html",finalize:"*parseSub"};g.activity.initialize.templateOptions=function(c,a,b,d){if(m(d))d=d.split(","),b.templateId=i.trim(d[0]),b.wrapDataInArray="true"==i.trim(d[1]),b.engineName=d[2];else if(r(d)&&d.templateId)k(b,d);else if(!(b.templateId=a.hmData("embeddedTemplate")))if(c=i.trim(a.html()))c=c.replace(Sb,Tb),b.templateId="__"+i.uuid++,B.compile(b.templateId,c),a.hmData("embeddedTemplate",b.templateId),a.empty();else throw"missing template";};var Sb=/&lt;|&gt;/g,
Ub={"&lt;":"<","&gt;":">"},Tb=function(c){return Ub[c]||""};Xa.prototype.get=function(){var c=this.e.publisher;return c.get.apply(c,q.call(arguments))};g.activity.convert.dataToMarkup=function(c,a){if(c&&(w(c)&&c.length||!w(c))){var b=a.workflow,d;var f=b.templateId,h=b.wrapDataInArray?[c]:c;d=new Xa(a);var g=Ya(b.engineName,f),f=i.trim(f);if(g.isTemplateLoaded(f))d=g.render(f,h,d);else if(g.renderAsync)d=g.renderAsync(f,h,d);else{var u=i.Deferred(),b=k(!0,{},d.e),j=k(!0,{},b.publisher),l=k(!0,{},
d);b.publisher=j;l.e=b;B.load(f).done(function(){var a=g.render(f,h,l),b=i(a);u.resolve(b.selector||!b.length?a:b)});d=u.promise()}if(N(d))return d;m(d)&&(d=i.trim(d));return i(i("<div />").html(d)[0].childNodes)}return""};g.activity.finalize.parseSub=function(c){i(c).parseSub()};g.workflowType({renderContent:Aa,renderSelf:X("get","replaceWith")});k(g.groups,{"for":"!init:.|*renderContent",forSelf:"!init after*.:.|*renderContent",forChildren:"!init after*. after*.1:.|*renderContent",forAll:"!init after*:.|*renderContent",
renderSelf:"!init:.|*renderSelf"});W.renderContent=function(c,a,b){a=a||"";p(b)&&(b={finalize:b});return this.initView(a,b?k({},Aa,b):"*renderContent",c)};W.renderSelf=function(c,a,b){p(b)&&(b={finalize:b});return this.initView(a,b?k({},g.workflowType("renderSelf"),b):"*renderSelf",c)};g.template=B={defaultEngine:"",engineAdapter:function(c,a){if(!c)return oa;if(!a)return oa[c];a.isTemplateLoaded=a.isTemplateLoaded||x;oa[c]=a;B.defaultEngine=c},load:function(){throw"not implemented";},compile:function(c,
a,b){return Ya(b).compile(c,a)},newTemplateWorkflow:X};if(i.render&&i.templates){var Ia;B.engineAdapter("jsrender",Ia={render:function(c,a,b){i.render[c]||this.compile(c,document.getElementById(c).innerHTML);return i.render[c](a,b)},compile:function(c,a){i.templates(c,{markup:a,debug:Ia.templateDebugMode,allowCode:Ia.allowCodeInTemplate})},isTemplateLoaded:function(c){return!!i.render[c]||!!document.getElementById(c)},templateDebugMode:!1,allowCodeInTemplate:!0});var ib=i.views.tags;ib({ts:function a(){return a.enabled?
"<span style='color:red' data-sub='show:/*ts'>updated on:"+(+new Date+"").substring(7,10)+"</span>":""},indexToNs:function(){var a=this.tagCtx.view.index,b=this.ctx.modelPath;j(a)&&(a=this.ctx.e.publisher.count()-1);return"ns:/"+b+"."+a},get:function(){var a=this.ctx.e.publisher;return a.get.apply(a,q.call(arguments))},prop:function(){var a=this.tagCtx.view.index;j(a)&&(a=this.ctx.e.publisher.count()-1);a=this.ctx.e.publisher.cd(a);return a.get.apply(a,q.call(arguments))},keyToNs:function(){return"ns:/"+
this.ctx.modelPath+".table."+this.ctx.e.publisher.itemKey(this.tagCtx.view.data)},dataPathAsNs:function(){return"ns:/"+this.ctx.modelPath}});ib.ts.render.enabled=!0;g("*ts",!1)}"undefined"!=typeof Handlebars&&(g.template.engineAdapter("handlebars",{render:function(a,b,d){return Handlebars.partials[a](b,{data:{renderContext:d}})},compile:function(a,b){Handlebars.registerPartial(a,Handlebars.compile(b))},isTemplateLoaded:function(a){return!!Handlebars.partials[a]}}),Handlebars.registerHelper("modelPath",
function(a){return a.data.renderContext.modelPath}),Handlebars.registerHelper("indexToNs",function(a){return"ns:/"+a.data.renderContext.modelPath+"."+a.data.index+";"}),Handlebars.registerHelper("keyToNs",function(a){a=a.data.renderContext;return"ns:/"+a.modelPath+".table."+a.e.publisher.itemKey(this)}),Handlebars.registerHelper("get",function(){var a=arguments,b=a.length-1,d=a[b].data.renderContext;return d.get.apply(d,q.call(a,0,b))}),Handlebars.registerHelper("prop",function(){var a=[].slice,b=
arguments,d=b.length-1,f=b[d].data,f=f.renderContext.e.publisher.cd(f.index);return f.get.apply(f,a.call(b,0,d))}),i(function(){i("script[type=handlebars]").each(function(){Handlebars.registerPartial(this.id,Handlebars.compile(i(this)[0].innerHTML))})}));var Y=[{name:"textBoxOrDropDown",get:function(a){return a.val()},set:function(a,b){a.val()!==b&&a.val(b)},match:x},{name:"checkbox",get:Za,set:function(a,b){var d=a[0];d.checked=$(b)?b:b==d.value},match:function(a){return a.is(":checkbox")}},{name:"radio",
get:Za,set:function(a,b,d){a=a[0];if(!a.name)a.name=d.publisher.path;a.checked=G.toString(b)==a.value},match:function(a){return a.is(":radio")}},{name:"listBox",get:function(a){var b=[];a.children("option:selected").each(function(){b.push(this.value)});return b},set:function(a,b){function d(){if(this.value==h)this.selected=true}a.children("option:selected").removeAttr("selected");for(var f=0,h;f<b.length;f++){h=b[f];a.children("option").each(d)}},match:function(a){return a.is("select[multiple]")}}];
g.activity.get.getViewValue=function(a){return a.workflow.getViewValue(a.publisher)};g.activity.set.setViewValue=function(a,b){return b.workflow.setViewValue(this,a,b)};g.workflowType({updateViewValue:{initialize:function(a,b,d,f){$a(b,d,f,"set")},get:"get",set:"*setViewValue"},updateModelValue:{initialize:function(a,b,d,f){$a(a,d,f,"get")},get:"*getViewValue",set:"set"}});g.valueAdapter=function(a){if(a)Y.push(a);else return Y};g.groups.val=function(a,b,d,f){var h,g,i;if(f=f||""){f=f.split(",");
g=f[0]||"change";h=f[1];i=f[2]}else g="change";(!h||h=="updateView")&&d.appendSub(a,b,"init1 after*","*updateViewValue",i);(!h||h=="updateModel")&&d.appendSub(b,a,g+" resetVal","*updateModelValue",i)};g.groups.resetFormValues=function(a){function b(){d.find(":input").trigger("resetVal")}var d=i(a);d.bind("reset",function(){setTimeout(b,1)})};l.confirmMessage="Are you sure?";g.activity.get.compareTruthy=function(a){var b=a.workflow.options,a=a.publisher;return j(b)?!a.isEmpty():a.compare(b)};g.activity.initialize.extractClass=
function(a,b,d,f){a=f.split(",");d.className=a[0];d.options=a[1]};var jb={options:["!init after*:.|*options",{get:function(a){var b=a.workflow.options,d=this.val();this.children("option[listItem]").remove().end().append(function(){var d="";i(a.publisher.get()).each(function(){d=d+("<option listItem='1' value='"+b.value(this)+"'>"+b.name(this)+"</option>")});return d}).val(d);this.val()!==d&&i(this.trigger("change"))},initialize:function(a,b,d,f){if(f){var a=f.split(","),h=a[0],g=a[1]||a[0];d.options=
{name:function(a){return a[h]},value:function(a){return a[g]}}}else d.options={name:function(a){return a.toString()},value:function(a){return a.toString()}}}}],show:["!init after*:.|*show",{get:"*compareTruthy",set:function(a){this[a?"show":"hide"]()}}],hide:["!init after*:.|*hide",{get:"*compareTruthy",set:function(a){this[a?"hide":"show"]()}}],enable:["!init after*:.|*enable",{get:"*compareTruthy",set:function(a){this.attr("disabled",!a)}}],disable:["!init after*:.|*disable",{get:"*compareTruthy",
set:function(a){this.attr("disabled",a)}}],addClass:["!init after*:.|*addClass",{initialize:"*extractClass",get:"*compareTruthy",set:function(a,b){this[a?"addClass":"removeClass"](b.workflow.className)}}],removeClass:["!init after*:.|*removeClass",{initialize:"*extractClass",get:"*compareTruthy",set:function(a,b){this[a?"removeClass":"addClass"](b.workflow.className)}}],toggleClass:["!init after*:.|*toggleClass",{get:function(a){var b,d,f=a.publisher.get(),h=a.workflow.options;if(h){if(h.startsWith("!")){d=
true;h=h.substr(1)}b=f^d?"addClass":"removeClass"}if(a.type=="init")if(h)this[b](h);else this.addClass(f);else if(h)this[b](h);else this.removeClass(a.removed).addClass(f)}}],focus:["!init after*:.|*focus",{get:"*compareTruthy",set:function(a){if(a){var b=this;setTimeout(function(){b.focus().select()},1)}}}],count:["!init after*:.|*count",function(a){a=a.publisher.get();this.text("length"in a?a.length:a)}],dump:["!init *:.|*dump",function(a){a.type.startsWith("before")||this.html("<span style='color:red'>"+
a.publisher.path+" : "+a.publisher.toJSON()+"</span>")}],alert:["$click:.|*alert",function(a){alert(j(a.workflow.options)?this.get():a.workflow.options)}],preventDefault:["$click:_|*preventDefault",function(a){a.preventDefault()}],stopPropagation:["$click:_|*stopPropagation",function(a){a.stopPropagation()}],confirm:[function(a,b,d,f){g.sub(b,a,"click","*confirm",f)},function(a){var b=j(a.workflow.options)?this&&this.get&&this.get()||l.confirmMessage:a.workflow.options;if(!confirm(b)){a.stopImmediatePropagation();
a.preventDefault&&a.preventDefault()}}],hardCode:["$click:.|*hardCode",{initialize:function(a,b,d,f){d.hardCode=ea(f)},get:function(a){this.set(a.workflow.hardCode)}}],"0":["$click:.|*0",function(){this.set(0)}],emptyString:["$click:.|*empty",function(){this.set("")}],"null":["$click:.|*null",function(){this.set(null)}],"true":["$click:.|*true",function(){this.set(true)}],"++":["$click:.|*++",function(){this.set(this.get()+1)}],"--":["$click:.|*--",function(){this.set(this.get()-1)}],"false":["$click:.|*false",
function(){this.set(false)}],toggle:["$click:.|*toggle",function(){this.set(!this.get())}],sortItems:["$click:.|*sortItems",{initialize:function(a,b,d,f){f=(f||"")&&f.split(",");d.by=f[0];d.asc=!!f[1]},get:function(a){a=a.workflow;this.sort(a.by,a.asc);a.asc=!a.asc}}],clear:["$click:.|*clear",function(){this.clear()}],del:["$click:.|*del;confirm:_|_Do you want to delete this item?",function(){this.del()}]},sa;for(sa in jb){var kb=jb[sa];g.groups[sa]=kb[0];g.workflowType(sa,kb[1])}k(g.groups,{caption:function(a,
b,d,f){i(a).prepend("<option value=''>"+(f||g.get(b))+"</option>")},autofocus:function(a){setTimeout(function(){i(a).focus()},1)},mapEvent:function(a,b,d,f){f=f.split(",");i(a).mapEvent(f[0],f[1],f[2])},mapClick:function(a,b,d,f){f=f.split(",");i(a).mapEvent("click",f[0],f[1])},logPanel:function(a,b,d){var a=i(a),f=a.is("ol")?a:i("<ol style='font-family: monospace, serif' />").appendTo(a),a=f[0];d.appendSub(a,"*log","init",function(a){for(var a=a.publisher.get(),b=0;b<a.length;b++)f.append("<li>"+
a[b]+"</li>")});d.appendSub(a,"*log","afterCreate.1",function(a){f.append("<li>"+a.originalPublisher.raw()+"</li>")});d.appendSub(a,"*log","afterCreate",function(){f.empty()})},clearlog:"clear:/*log",enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",html:"!init after*:.|get html *toString",text:"!init after*:.|get text *toString"});g.newViewEvent({enter:["keyup",function(a){return a.keyCode===13}],esc:["keyup",function(a){return a.keyCode===27}],ctrlclick:["click",function(a){return a.ctrlKey}]});
var Vb={create:"POST",update:"PUT",destroy:"DELETE",fetch:"GET"},v={detached:0,unchanged:1,added:3,deleted:4,modified:5};g.onAddOrUpdateNode(function(a,b,d){if(d instanceof g.Entity){if(d.__state===v.detached)d.__state=v.added;if(j(g(a).get("__entityContainer"))){g.sub(a,a,"afterUpdate.*",ub);g(a).set("__entityContainer",true)}}});g.Entity=g.Class.extend({__state:v.detached,create:function(){if(this instanceof g){if(this.get("__state")==v.added)return pa(this,"create");throw"entity is not a new item";
}return this.constructor.create(this)},fetch:function(){return this instanceof g?pa(this,"fetch"):this.constructor.fetch(this)},update:function(){if(this instanceof g){if(this.get("__state")==v.modified)return pa(this,"update")}else return this.constructor.update(this)},destroy:function(){if(this instanceof g){var a=this;return pa(this,"destroy").done(function(){a.del()})}return this.constructor.destroy(this)},save:function(){if(this instanceof g){var a=this.get("__state");if(a==v.added)return this.get("create");
if(a==v.modified)return this.get("update")}else throw"not supported";}},{state:v,create:function(a){return this.ajax("create",a)},update:function(a){return this.ajax("update",a)},destroy:function(a){return this.ajax("destroy",a)},fetch:function(a){if(a)return this.ajax("fetch",a);var b=this;return this.ajax("fetch").pipe(function(a){return i(b.list(a)).each(function(){this.__state=v.unchanged}).get()})},getUrl:function(a,b){var d=this.url||b.url,f=b&&b.id;return f?d+(d.charAt(d.length-1)==="/"?"":
"/")+encodeURIComponent(f):d},ajax:function(a,b){var d=Vb[a],d={type:d,dataType:"json",url:this.getUrl(a,b),contentType:d=="GET"?null:"application/json",processData:false,data:d=="GET"?null:JSON.stringify(b)};return i.ajax(d).done(function(a){b&&k(b,a)})}});k(F,{save:function(){return this.get("save")},destroy:function(){return this.get("destroy")},fetch:function(){return this.get("fetch")}});l.errors={defaultError:"Please enter a valid value"};var da=K.invalidPaths=[],qa=g("*invalidPaths"),cb=/^\s*$/,
lb=/^\d+$/,Wb=/Invalid|NaN/,Xb=/^(\/(\\[^\x00-\x1f]|\[(\\[^\x00-\x1f]|[^\x00-\x1f\\\/])*\]|[^\x00-\x1f\\\/\[])+\/[gim]*)(,(.*))*$/,fa=/([^,]+)(,(.*))?/,mb=/(\w+),(\w+)(,(.*))?/;g.validator=function(a){if(w(a)){for(var b=0;b<a.length;b++)g.validator(a[b]);return this}b=a.name;if(g.workflowType(b))throw"validator name '"+b+"' collide with name in hm.workflowTypes";if(a.error)l.errors[b]=a.error;var d="v_"+b;g.workflowType(d,vb(a));g.groups[b]="!afterUpdate checkValidity:.|*"+d};g.workflowType({checkValidity:function(a){g.checkValidity(this.path)||
a.stopImmediatePropagation()},warn:function(a){a.publisher.isEmpty()?this.removeClass("error").next("span.error").remove():this.addClass("error").next("span.error").remove().end().after("<span class='error'>"+a.publisher.get()+"</span>")},renderErrorSummary:g.template.newTemplateWorkflow(function(a){return[a.publisher.getErrors()]})});k(g.groups,{validator:function(a,b,d,f){if(!f)throw"missing validator path";f.startsWith("#")||(f="#"+f);g(b).validator(f)},checkValidity:function(a,b,d){d.prependSub(b,
a,"click","*checkValidity")},resetFormValidity:function(a,b,d){d.appendSub(b,a,"reset","*skipGet resetValidity")},resetForm:"resetFormValidity:.;resetFormValues:.",resetValidity:"$click:.|*skipGet resetValidity",warn:"!after*:*errors|*warn",warnSummary:"!afterUpdate* validityChecked:.|*renderErrorSummary;!validityReset:.|empty"});g.subscription.special.validityChanged={setup:function(a,b){var d=b+"*isValid";j(g.get(d))&&g.sub(b,"*invalidPaths","!after*. after*.1",function(){var a=ab(b);if(g.get(d)!==
a){g.trigger(b,b,"validityChanged",a,!a);g.set(d,a)}})}};k(F,{checkValidity:function(a){a=this.getPath(a);db(a,function(a){o(a,a,"checkValidity",n.get(a))});var b=ab(a);g.trigger(a,a,"validityChecked",b);return b},validator:function(a,b){var d,f;if(r(a))for(d in a)this.cd(d).validator(a[d]);else if(p(a)||m(a)&&a.startsWith("#")){m(a)&&(a=this.raw(a.substr(1)));g.handle(this.path,"afterUpdate* checkValidity",function(b){var d=b.publisher,f=a.previousError;if(b.proposed===null||b.proposed===s||cb.test(b.proposed)){if(f){d.removeError(f);
a.previousError=""}}else{b=a(d.get());if(b===false)b=l.errors.defaultError;if(m(b)){if(b!=f){d.addError(b);f||d.removeError(f);a.previousError=b}}else if(f){d.removeError(f);a.previousError=""}}})}else if(m(a))g.handle(this.path,"afterUpdate* checkValidity","*v_"+a,b);else if(w(a))for(d=0;d<a.length;d++){f=a[d];w(f)?this.validator(f[0],f[1]):this.validator(f)}return this},resetValidity:function(){bb(this.path);H(this.get())||db(this.path,bb);g.trigger(this.path,this.path,"validityReset")},addError:function(a){this.createIfUndefined("*errors",
[]).cd("*errors").pushUnique(a);qa.pushUnique(this.path);return this},removeError:function(a){var b=this.createIfUndefined("*errors",[]).cd("*errors");b.removeItem(a);b.isEmpty()&&qa.removeItem(this.path);return this},getErrors:function(){var a,b=this.path,d,f=[];for(a=0;a<da.length;a++){d=da[a];if(d==b||d.startsWith(b))f=f.concat(g.get(d+"*errors"))}return f}});g.checkValidity=function(a){return n.checkValidity(a)};g.onDeleteNode(function(a){qa.removeItem(a)});g.validator.defaultErrorBuilder=M;g.validator.buildRegexFn=
Z;g.validator([{name:"required",error:"This field is required.",isValid:x},{name:"email",error:"Please enter a valid email address.",isValid:Z(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)},
{name:"url",error:"Please enter a valid URL.",isValid:Z(/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i)},
{name:"date",error:"Please enter a valid date.",isValid:function(a){return!Wb.test((new Date(a)).toString())}},{name:"dateISO",error:"Please enter a valid date (ISO).",isValid:Z(/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/)},{name:"number",error:"Please enter a valid number.",isValid:Z(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/)},{name:"digits",error:"Please enter only digits.",isValid:Z(lb)},{name:"creditcard",error:"Please enter a valid credit card number.",isValid:function(a){if(/[^0-9\-]+/.test(a))return false;
for(var b=0,d=0,f=false,a=a.replace(/\D/g,""),h=a.length-1;h>=0;h--){d=a.charAt(h);d=parseInt(d,10);if(f&&(d=d*2)>9)d=d-9;b=b+d;f=!f}return b%10===0}},{name:"minlength",error:"Please enter at least {minlength} characters.",isValid:function(a,b){return a.length>=b.minlength},initialize:function(a,b,d,f){var h;if(f&&(h=fa.exec(f)))d.options={minlength:+h[1],error:h[3]};else throw"invalid options for minlength validator";},buildError:M},{name:"maxlength",error:"Please enter no more than {maxlength} characters.",
isValid:function(a,b){return a.length<=b.maxlength},initialize:function(a,b,d,f){var h;if(f&&(h=fa.exec(f)))d.options={maxlength:+h[1],error:h[3]};else throw"invalid options for maxlength validator";},buildError:M},{name:"rangelength",error:"Please enter a value between {minlength} and {maxlength} characters long.",isValid:function(a,b){return a.length>=b.minlength&&a.length<=b.maxlength},initialize:function(a,b,d,f){var h;if(f&&(h=mb.exec(f)))d.options={minlength:+h[1],maxlength:+h[2],error:h[4]};
else throw"invalid options for rangelength validator";},buildError:M},{name:"min",error:"Please enter a value greater than or equal to {min}.",isValid:function(a,b){return a>=b.min},initialize:function(a,b,d,f){var h;if(f&&(h=fa.exec(f)))d.options={min:+h[1],error:h[3]};else throw"invalid options for min validator";},buildError:M},{name:"max",error:"Please enter a value less than or equal to {max}.",isValid:function(a,b){return a<=b.max},initialize:function(a,b,d,f){var h;if(f&&(h=fa.exec(f)))d.options=
{max:+h[1],error:h[3]};else throw"invalid options for max validator";},buildError:M},{name:"range",error:"Please enter a value between {min} and {max}.",isValid:function(a,b){return a>=b.min&&a<=b.max},initialize:function(a,b,d,f){var h;if(f&&(h=mb.exec(f)))d.options={min:+h[1],max:+h[2],error:h[4]};else throw"invalid options for range validator";},buildError:M},{name:"equal",error:"Please enter the same value again.",isValid:function(a,b){return n.get(b.comparePath)===a},initialize:function(a,b,
d,f){var h;if(f&&(h=fa.exec(f))){b=a.cd(h[1]).path;d.options={comparePath:b,error:h[3]};a.sub(b,"afterUpdate",function(){this.isEmpty()||o(this.path,this.path,"checkValidity",this.get())})}else throw"invalid options for equal validator";}},{name:"regex",error:"Please enter a value match with required pattern.",isValid:function(a,b){return b.regex.test(a)},initialize:function(a,b,d,f){var h;if(f&&(h=Xb.exec(f)))d.options={regex:eval(h[1]),error:h[5]};else throw"invalid options for regex validator";
}},{name:"fixedValue",error:'Please enter value "{fixedValue}"',isValid:function(a,b){return a==b.fixedValue},initialize:function(a,b,d,f){if(m(f)){if(a=/^(\w+)(,(.*))*$/.exec(f))d.options={fixedValue:ea(a[1]),error:a[3]}}else if(r(f))d.options=f;else{if(j(f))throw"missing options in fixedValue validator";d.options={fixedValue:f}}},buildError:M}]);var wb=g.workflowType("v_required").get;"undefined"!=typeof matrix&&(B.load=function(a){return matrix(a+".template")},matrix.loader.set("template",{load:{compile:function(a,
b){i(b).filter("script[id]").each(function(){var a=i(this);B.compile(this.id,a.html(),a.attr("type")||B.defaultEngine)})},buildDependencies:"parseDependsTag"},url:function(a){return B.templateIdToUrl(matrix.fileName(a))}}),B.templateIdToUrl=function(a){var b;if(a.startsWith("*")){a=a.substr(1);b=a.split(".");a="_";b=b[0]}else{b=a.split(".");a=b[0];b=b[1]||"main"}return"template/"+a+"/"+b+".html"});g.workflowType({addRowView:X("*getOriginal",function(a,b){var d=this.children();if(d.length===0)this.append(a);
else{var f=+b.originalPublisher.pathIndex();f===0?d.eq(0).before(a):d.eq(f-1).after(a)}}),updateRowView:X("*getOriginal",function(a,b){this.children().eq(+b.originalPublisher.pathIndex()).replaceWith(a)}),removeRowView:function(a){this.children().eq(+a.originalPublisher.pathIndex()).remove()}});F.initQueryable=function(a){function b(){var a=j.ops,b=j.by,f=j.value,h;if(f){if(a)if(a=="equals")h=y("^"+f+"$","i");else throw"operator does not supported";else h=y(f,"i");g=b?function(){return h.test(this[b])}:
function(){if(r(this)){for(var a in this)if(h.test(this[a]))return true;return false}return h.test(this)};q.set(true);d.refreshQuery()}else if(g){g=null;q.set(false);d.refreshQuery()}}if(this.get("*query"))return this;var d,f,h,g,j,k=this.get(),l=this.cd("*query"),m=this.cd("*queryResult"),n=this.cd("*hasQueryResult"),p=l.cd("pager"),o=l.cd("filter"),q=o.cd("enabled"),s=l.cd("sort");(a=!!a)&&m.reference(l.path);m.reference(this.path);this.extend("*",d={autoQuery:a,hasQueryResult:false,query:{pager:h=
{enabled:false,index:0,count:1,size:0},sort:f={by:null,asc:null},filter:j={by:"",value:"",ops:"",enabled:false},enabled:function(){return this.get("pager.enabled")||this.get("sort.by")||this.get("filter.enabled")}},queryResult:function(a){var b=i(k),b=g?b.filter(g).get():b.get();n.update(b.length>0);f.by&&b.sortObject(f.by,f.asc);if(!a&&h.enabled){a=Math.ceil(b.length/h.size)||1;if(a!=h.count){h.count=a;if(h.index>h.count-1)h.index=0;l.triggerChange("pager")}b=b.slice(h.index*h.size,(h.index+1)*h.size)}return b},
refreshQuery:function(){d.autoQuery||setTimeout(function(){m.trigger("afterUpdate")},0)},paging:function(a){a=a.eventData;if(lb.test(a))a=+a;else if(a=="next")a=h.index+1;else if(a=="previous")a=h.index-1;else if(a=="first")a=0;else if(a=="last")a=h.count-1;else if(a=="disabled"){a=0;d.resetPaging()}if(typeof a!=="number"||a<0||a>h.count-1)a=0;p.update("index",a);d.refreshQuery()},resetSort:function(a){s.set("by",null).set("asc",null);a!==true&&d.refreshQuery()},resetSearch:function(a){o.update("by",
"").update("value","").update("ops","");a!==true&&d.refreshQuery()},resetPaging:function(a){p.update("enabled",false).update("size",0).update("count",1).update("index",0);a!==true&&d.refreshQuery()},resetQuery:function(){d.resetSort(true);d.resetSearch(true);d.resetPaging(true);d.refreshQuery()}});o.cd("by").handle("afterUpdate",b);o.cd("value").handle("afterUpdate",b);o.cd("ops").handle("afterUpdate",b);return this};k(g.groups,{listView:"forSelf:.;!afterCreate.1:.|*addRowView;!afterUpdate.1:.|*updateRowView;!afterDel.1:.|*removeRowView",
initQueryable:function(a,b,d,f){g(b).initQueryable(!!f)},queryView:"forAll:*queryResult",sortQueryButton:"$click:*query.sort.by|*hardCode;$click:*query.sort.asc|*toggle;$click:*refreshQuery",resetSortButton:"$click:*resetSort;show:*query.sort.by",searchButton:"$click:*refreshQuery;enable:*query.filter.enabled",resetSearchButton:"$click:*resetSearch;show:*query.filter.enabled",resetQueryButton:"$click:*resetQuery;show:*query.enabled",searchBox:"ns:*query.filter.value;val:.|enter;$esc:.|*null",pager:"forAll:*query.pager;show:*hasQueryResult|_;$paging:*paging;preventDefault:.",
setPageButton:"true:*query.pager.enabled;enable:*query.pager.size;$click:*refreshQuery",page:function(a,b,d,f){if(!f)throw"pageIndex is missing";i(a).mapEvent("click","paging",f)},showFound:"show:*hasQueryResult",hideFound:"hide:*hasQueryResult"});g.table=function(a){j(a)?a=[]:w(a)||(a=[a]);if(a.table&&a.guid)return a;a.table={};a.guid=0;return a};g.onAddOrUpdateNode(function(a,b,d){var f=w(d)&&d.table;if(f){for(var h=0;h<d.length;h++)f["c"+d.guid++]=d[h];a=g(a).cd(b);b=a.cd("table");b.sub(a,"afterCreate.1",
yb);b.sub(a,"afterUpdate.*",xb);b.sub(a,"afterDel.1",zb);a.sub(b,"afterDel.1",Ab);a.sub(b,"afterUpdate.1",Bb)}});F.itemKey=function(a){var b,d;d=this.raw();p(d)&&(d=this.main().get());if(d=d.table)for(b in d)if(a===d[b])return b};F.keyAt=function(a){return this.itemKey(this.get(a))};g.Class.table=function(a){return g.table(this.list(a))};i.Event.prototype.selectedRowIndex=function(){return this.publisher.children().filter(this.originalPublisher.parents()).index()};Ba.prototype={item:null,mode:function(){var a=
this.get(),b=a.selectedIndex;return a.item===null?"read":j(b)?"update":b==-1?"new":"update"}};k(F,{initShadowEdit:function(a){var b=this;if(!b.get("*edit")){var d=b.path,f=y("^"+d.replace(".","\\.")+"\\*edit\\.item[^*]+\\*$"),h=y("^"+d.replace(".","\\.")+"\\*edit\\.item[\\w.]+\\*edit\\.item");if(j(a))if(b.isShadow()&&!p(b.raw()))var a=b.main(),g=(a.logicalPath()+"*edit.item").length+1,d=C(d).substr(g),a=aa(a.get("*edit.itemTemplate."+d+".0"),true);else{a=p(b.raw())?n.raw(b.main().path+"_itemTemplate"):
n.raw(d+"_itemTemplate");j(a)&&(a=Fa(aa(b.get()[0],true)))}d=new Ba(-1);d.itemTemplate=a;d.item=null;b.set("*edit",d);b.cd("*edit.selectedIndex").handle("afterUpdate",function(a){var d=a.proposed,a=a.removed;d>=0?b.trigger("beginInRowUpdate",d):d==-1&&b.trigger("cancelInRowUpdate",a)});b.cd("*edit.item").handle("afterUpdate",function(){var a,b;for(a in K){b=G.toLogicalPath("__hm."+a);if(h.test(b))delete K[a];else if(f.test(b))if(b=K[a].edit){b.item=null;b.selectedIndex=-1}}});return this}},newShadowItem:function(){this.get("*edit.mode")!==
"read"&&this.resetShadowItem();var a=this.cd("*edit"),b=a.raw("itemTemplate"),b=p(b)?b():aa(b,true);a.update("item",b);a.triggerChange("mode")},editShadowItem:function(a,b){var d=this.raw();if(H(d)||r(d)){var f=this.get("*edit");if(j(f)){f=new Ba;this.set("*edit",f)}if(f.item===null){this.set("*edit.item",aa(d,true));this.triggerChange("*edit.mode")}}else{this.get("*edit.mode")!=="read"&&this.resetShadowItem();j(b)?b=this.indexOf(a):a=this.get()[b];d=this.cd("*edit");f=d.raw("itemTemplate");f=p(f)?
f(a):aa(a,true);d.update("item",f).update("selectedIndex",b);d.triggerChange("mode")}},resetShadowItem:function(a){if(this.path.endsWith(".edit.item"))return this.main().resetShadowItem();var b=this.raw();if(H(b)||r(b)){this.set("*edit.item",null);this.triggerChange("*edit.mode")}else{b=this.cd("*edit");if(!j(b.get())){b.update("item",null);a?b.get().selectedIndex=-1:b.update("selectedIndex",-1);b.triggerChange("mode")}}},saveShadowItem:function(){if(this.path.endsWith(".edit.item"))return this.main().saveShadowItem();
var a=this.raw();if(H(a)||r(a)){this.set(this.get("*edit.item")).set("*edit.item",null);this.triggerChange("*edit.mode")}else{var b=this.get("*edit.mode"),d=this.get("*edit.item");if(b=="read")throw"invalid operations";if(b=="new"){p(a)?this.main().push(d):this.push(d);this.resetShadowItem()}else{b=this.get("*edit.selectedIndex");if(p(a)){a=this.get();this.main().replaceItem(a[b],d)}else this.replaceItem(a[b],d);this.resetShadowItem(true)}}}});g.workflowType({newShadowItem:"*skipGet newShadowItem",
editShadowItem:function(a){a.type=="editRow"?this.editShadowItem(null,a.selectedRowIndex()):this.path.endsWith(".edit.item")?this.main().editShadowItem(this.get()):this.editShadowItem();a.stopPropagation()},removeItem:function(a){this.get("*edit.mode")!="read"&&this.resetShadowItem();var b=a.selectedRowIndex(),d=this.raw();if(p(d)){d=this.get();this.main().removeItem(d[b])}else this.removeAt(b);a.stopPropagation()},moveUpItem:function(a){var b=a.selectedRowIndex();this.move(b,b-1);a.stopPropagation()},
moveDownItem:function(a){var b=a.selectedRowIndex();this.move(b,b+1);a.stopPropagation()},renderNewView:X(function(a){if(a.publisher.get()=="new")return a.publisher.main().get("*edit.item")}),renderUpdateRowView:X(function(a){return a.publisher.get("*edit.item")},function(a,b){this.children().eq(b.proposed).replaceWith(a)}),destroyUpdateRowView:function(a){a.publisher.triggerChange(a.proposed)},saveShadowItem:function(a){this.saveShadowItem();a.stopPropagation()},resetShadowItem:function(a){this.resetShadowItem();
a.stopPropagation()}});k(g.groups,{shadowEdit:"!init:.|initShadowEdit *skipSet;deleteRow:.;$editRow:.|*editShadowItem",shadowEditInRow:"shadowEdit:.;!beginInRowUpdate:.|*renderUpdateRowView;!cancelInRowUpdate:.|*destroyUpdateRowView",deleteRow:"$deleteRow:.|*confirm|_Do you want to delete this item?;$deleteRow:.|*removeItem;",movableRow:"$moveUp:.|*moveUpItem;$moveDown:.|*moveDownItem;",newItemView:"!afterUpdate:*edit.mode|*renderNewView;showOnNew:.",showOnNew:"show:*edit.mode|_new",hideOnNew:"hide:*edit.mode|_new",
editItemView:"forSelf:*edit.item;showOnEdit:.",displayItemView:"forSelf:.;hideOnEdit:.",showOnEdit:function(a,b,d){d.appendSub(a,b+"*edit.mode","init afterUpdate",function(a){a=a.publisher.get();this[j(a)||a=="read"?"hide":"show"]()})},hideOnEdit:function(a,b,d){d.appendSub(a,b+"*edit.mode","init afterUpdate",function(a){a=a.publisher.get();this[j(a)||a=="read"?"show":"hide"]()})},newItem:"$click:.|*newShadowItem;hideOnNew:.",editObject:"$click:.|*editShadowItem;hideOnEdit:.",saveButton:"$click:.|*saveShadowItem",
cancelSaveButton:"$click:.|*resetShadowItem"});g.newViewEvent({editRow:["click",function(a){return i(a.target).hasClass("editRow")}],deleteRow:["click",function(a){return i(a.target).hasClass("deleteRow")}],moveUp:["click",function(a){return i(a.target).hasClass("moveUp")}],moveDown:["click",function(a){return i(a.target).hasClass("moveDown")}]});if(i.bbq){var ta=[],nb=i.bbq.getState,Yb=i.bbq.pushState,Zb=function(a){var a=r(a)?C(a.publisher.path):a,b={};b[a]=n.get(a);Yb(b)};g.bookmarkable=function(){var a,
b,d=nb(),f={};for(a=0;a<arguments.length;a++){b=arguments[a];b in d&&n.set(b,d[b]);g.sub(null,b,"afterUpdate",Zb);ta.push(b)}for(a=0;a<ta.length;a++){b=C(ta[a]);f[b]=n.get(b)}a=i.param.fragment(location.href,f);history.replaceState?history.replaceState(null,null,a):location.href=a;return this};F.bookmarkable=function(a){var b=this;g.bookmarkable.apply(g,i.map(a?arguments:[""],function(a){return b.getPath(a)}));return b};i(ha).bind("hashchange",function(){var a=nb(),b;for(b in a)ta.contains(b)&&n.set(b,
a[b])})}l.selectedClass="selected";l.tabViewAttr="data-tabView";l.tabLinkAttr="data-tabLink";l.tabGroupAttr="data-tabGroup";g.workflowType({highlightTab:function(a){var b=this.attr(l.tabViewAttr)||this.attr(l.tabLinkAttr),d=a.workflow.options||l.selectedClass;a.publisher.get()==b?this.addClass(d):this.removeClass(d)},highlightTabInContainer:function(a){var b=a.publisher.get(),d=l.tabViewAttr,f=l.tabLinkAttr,a=a.workflow.options,h=a.selectedClass||l.selectedClass;this.find(a.selector).andSelf().each(function(a,
g){var j=i(g);(j.attr(d)||j.attr(f))==b?j.addClass(h):j.removeClass(h)})}});g.groups.tab=function(a,b,d,f){d.appendSub(a,b,"init afterUpdate","*highlightTab",f);i(a).attr(l.tabLinkAttr)&&d.appendSub(b,a,"click",eb,l.tabLinkAttr)};g.groups.tabContainer=function(a,b,d,f){var f=(f||"").split(","),h=l.tabLinkAttr,g=l.tabGroupAttr,i=f[0]?"["+g+"='"+f[0]+"']":"",g="["+h+"]"+i,i=g+",["+l.tabViewAttr+"]"+i;d.appendSub(b,a,"click",eb,h,g);d.appendSub(a,b,"init100 afterUpdate","*highlightTabInContainer",{selector:i,
selectedClass:f[1]})};var P={},$b=/^([^,]+)(,(.+))?$/,ob=/^([^,]+)(,([^,]+))?(,(.+))?$/;g.App=g.Class.extend({bootstrap:function(a,b,d){if(a&&this.loadable()){var f=this,g,j=f.name;if(!ga.get(a,j)){f.buildRootModel!==false&&(g=f.buildRootModel(b,d));N(g)?g.done(function(){f.buildRootView(a,b)}):f.buildRootView(a,b);ga.add(a,b,j,f);i(a).bind("shutdown."+j,function(a){f.shutdown(this,a.namespace);a.stopPropagation()});f.instanceCount++}}},shutdown:function(a,b){var d=this.name;this.destroyRootView(a);
this.destroyRootModel(b);ga.remove(a,d);i(a).unbind("shutdown."+d);this.instanceCount--},fetchRootData:null,buildRootModel:function(a,b){var d=this;if(!d.fetchRootData)throw"app.fetchRootData is not implemented";var f=d.fetchRootData(a,b);if(N(f))return f.done(function(b){g.set(d.getNamespace(a),b)});g.set(d.getNamespace(a),f)},destroyRootModel:function(a){this.buildRootModel!==false&&g(a).del(this.name)},buildRootView:function(a,b){i(a).renderContent(this.getTemplateOptions(),this.getNamespace(b))},
destroyRootView:function(a){i(a).empty()},getTemplateOptions:function(){return this.templateOptions||this.name},getNamespace:function(a){return g(a).getPath(this.subPath||this.name)},initialize:function(a){if(!a.name)throw"An app must have a name.";this.callBase("initialize",a)},instanceCount:0,loadable:x,templateOptions:null,subPath:null},{add:function(a){a instanceof this||(a=this(a));P[a.name]=a},remove:function(a){P[a]&&!P[a].instanceCount&&delete P[a]},get:function(a){return P[a]},bootstrap:function(a,
b,d,f){if(arguments.length==1){b=document.body;d=""}else if(arguments.length==2)if(b.jquery){b=b[0];d=""}else if(m(b)){d=b;b=document.body;d=""}var g=P[a];if(g)g.bootstrap(b,d,f);else{if(!this.fetch)throw"hm.App.fetch is not implemented";this.fetch(a).done(function(){P[a].bootstrap(b,d,f)})}},shutdown:function(a,b){if(j(a)){a=b;b=document.body}var d=ga.get(b,a);d&&d.app.shutdown(b,d.modelContainer)}});var ga={get:function(a,b){return this.appData(a)[b]},add:function(a,b,d,f){this.appData(a)[d]={app:f,
modelContainer:b}},remove:function(a,b){delete this.appData(a)[b]},appData:function(a,b){var d=i(a).hmData("app");if(!b&&!d){d={};i(a).hmData("app",d)}return d}};k(g.groups,{app:function(a,b,d,f){d=$b.exec(i.trim(f));g.App.bootstrap(d[1],a,b,d[3])},bootstrap:function(a,b,d,f){var d=ob.exec(i.trim(f)),h=d[1],j=i(d[3])[0],k=d[5];i(a).click(function(){g.App.bootstrap(h,j,b,k)})},shutdown:function(a,b,d,f){var b=ob.exec(i.trim(f)),h=b[1],j=i(b[3])[0];i(a).click(function(){g.App.shutdown(h,j)})},selfShutdown:function(a,
b,d,f){i(a).mapEvent("click","shutdown."+f)}});var ac=i.cleanData;i.cleanData=function(a){i(a).each(function(){var a=ga.appData(this,true);if(a)for(var d in a){var f=a[d];delete a[d];f.unload(this,true)}});ac(a)};"undefined"!==typeof matrix&&(matrix.loader.set("app","js",{url:"folder"}),g.App.fetch=function(a){return matrix(a+".app")})})(jQuery,window);
