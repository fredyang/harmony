/*! Harmony v0.1pre Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(j,x,u){function Qa(e,c){for(var a in c)e[a]||(e[a]=c[a])}function yb(e){return"."===e?"#":(new Aa(e.length+2)).join("#")}function Ra(e){if(e===H)return"";var c=Sa.exec(e);return c?c[1].replace(Ba,Ca):e}function Ca(e){return"#"==e?".":(new Aa(e.length)).join("#")}function Da(e,c,a){var b,d=e.lastIndexOf(".");k(a)&&(a=!0);if(a){-1===d?(a="",b=e):(a=e.substring(0,d),b=e.substring(d+1));d=a;a=b;for(var f=0;f<X.length;f++)X[f](d,a,c)}if(!L(c))for(b in c){d=e;a=b;for(var f=c[b],h=0;h<X.length;h++)X[h](d,
a,f);Da(e+"."+b,c[b],!1)}}function Ta(e,c){c=I(c);var a=M[c];a||(M[c]=a=[]);a.pushUnique(e)}function Ua(e,c){c=I(c);var a=M[c];a.remove(e);a.length||delete M[c]}function Va(e){return(e=zb.exec(e))&&e[1]||""}function oa(){return!1}function A(){return!0}function pa(e,c,a,b,d){this.publisher=N(e);this.originalPublisher=N(c);this.originalType=this.type=a;this.proposed=b;this.removed=d}function Wa(e){var c=e.workflow,a=c.getName,c=c.getParas;e=e.publisher;return c?e[a](c):r(e[a])?e[a]():e[a]}function Xa(e,
c){var a=c.workflow,b=a.setName;(a=a.setParas)?this[b](a,e):r(this[b])?this[b](e):this[b]=e}function Ya(e,c,a){var b=Y.getId(c);return j.map(e.split(Z),function(c){return n(a)?c+"."+H+"."+b+"."+a:c+"."+H+"."+b+"."+Y.getId(a)}).join(" ")}function N(e){return n(e)?g(e):e==$?null:t(e)&&!e.nodeType?e:j(e)}function Ab(e){return"."==e?"\\.":".*"}function Za(e){var c,a,b;b=e.publisher.subsToMe();for(a=0;a<b.length;a++){c=b[a];var d=e,f;a:{f=c.eventTypes;var h=e.type,g=void 0,j=void 0,k=j=g=void 0,l=void 0;
if("*"===f)f="*";else{f=f.split(Z);for(l=0;l<f.length;l++)if(j=f[l],j=(k=$a.test(j))?j.replace($a,""):j,j=j.replace(Bb,Ab),j=k?"^"+j:"^"+j+"$",g=new C(j),g=g.test(h))if(k){if(k="^"==j?h:C.rightContext,!k||!k.contains(".")){f=f[l];break a}}else{f=f[l];break a}f=void 0}}d.matchedType=f;e.matchedType&&qa(N(c.subscriber),c.workflow,e);if(e.isImmediatePropagationStopped())return}if(!e.isCascadeStopped()&&(c=M[e.publisher.path]))for(b=0;b<c.length;b++){a=q(c[b],e.originalPublisher.path,e.type);if(a.isImmediatePropagationStopped()||
a.isImmediatePropagationStopped())break;a.hasError()&&e.error()}}function qa(e,c,a,b){var d;a.workflow=c;a.subscriber=e;b=k(b)?c.get.call(e,a):c.get.apply(e,[a].concat(b));S(b)?(d=l(!0,{},a),b.done(function(b){c.convert&&(b=c.convert.call(e,b,a));if(!k(b))if(S(b))b.done(function(a){ra(e,c,a,d)});else return ra(e,c,b,a)})):(c.convert&&(b=c.convert.call(e,b,a)),k(b)||(S(b)?(d=l(!0,{},a),b.done(function(a){ra(e,c,a,d)})):ra(e,c,b,a)))}function ra(e,c,a,b){k(a)||(c.set&&c.set.call(e,a,b),c.finalize&&
c.finalize.call(e,a,b))}function aa(e){e.publisher=N(e.currentTarget);e.originalPublisher=N(e.target);var c=N(e.data.subscriber),a=e.data.workflow;delete e.data;1<arguments.length?qa(c,a,e,s.call(arguments,1)):qa(c,a,e)}function ab(e,c,a,b){e=e||"";if(n(e)){var d,f=e.split(Z),h;if(1==f.length)if(e.startsWith("*")){d=ba[e.substr(1)];if(!d)throw"common workflow "+e+" does not exist";d=l({},d)}else if(e.startsWith("#")?(d=e.substr(1),d=n(a)?D(a,d):n(c)?D(c,d):d,d=p.raw(d)):d=void 0,d)if(r(d))d=l({get:d,
options:b},d);else if(t(d)&&d.get)d=l({options:b},d);else throw"missing handler";else if(!k(c)&&!k(a)){d=n(c);f=n(a);if(d)e={get:"get",set:e||"set"};else if(f)if(e)e={get:e,set:"set"};else if(e=p.raw(a),r(e))e={get:p.raw(a)};else{if(!t(e)||!e.get)throw"missing handler";}else e={get:e,set:e};d=e}else throw"invalid handler";else{d={};for(var j=0;j<sa.length;j++)e=f[j],h=sa[j],e&&("_"!==e&&"null"!=e)&&(d[h]=e)}e=d}else if(r(e))e=l({get:e,options:b},e);else if(t(e)&&e.get)e=l({options:b},e);else throw"invalid workflow expression";
d=e;f=d.initialize;if(n(f))if(f.startsWith("*")){if(f=g.activity.initialize[f.substring(1)],!f)throw"initialize activity does not exist!";}else{var w=f;if(!p.raw(w))throw"initialize activity does not exist at path "+w;f=function(a,b,c,d){p.set(w,a,b,c,d)}}f?(f(N(c),N(a),d,b),delete d.initialize):k(b)||(d.options=b);ta("get",e,c,a);ta("set",e,c,a);ja(e,"convert");ja(e,"finalize");return e}function bb(e){var c;if(n(e)){var a=e.split(Z),b;if(1<a.length){e={};for(var d=0;d<sa.length;d++)c=a[d],b=sa[d],
c&&("_"!==c&&"null"!=c)&&(e[b]=c)}else throw"invalid workflow type";c=e}else if(r(e)||t(e)&&e.get)c=e,r(e)&&(c=l({get:e},c));else throw"invalid workflow expression";ja(c,"initialize");ta("get",c);ta("set",c);ja(c,"convert");ja(c,"finalize");return c}function ta(e,c,a,b){var d=c[e];if(d&&n(d)){var f=g.activity[e];if(d.startsWith("*")){if(d=d.substr(1),c[e]=f[d],!c[e])throw d+" does not exists "+e+" Activity";}else if(d=d.split("*"),c[e]="get"==e?Wa:Xa,c[e+"Name"]=d[0],d[1]&&(c[e+"Paras"]=d[1]),!k(a)&&
!k(b)){c=d[0];a="get"==e?a:b;var h;n(a)?J[c]||(h=!0):a.nodeType?ca[c]||(h=!0):c in a||(h=!0);if(h)throw("get"==e?"publisher":"subscriber")+" does not have a member "+c;}}}function ja(e,c){var a=e[c];if(n(a))if(a.startsWith("*")){if(e[c]=g.activity[c][a.substr(1)],!e[c])throw a+"Activity does not exists";}else e[c]=function(){return p.raw(a).apply(this,arguments)}}function cb(e){if(t(e)){if(!Y.getId(e))return;Y.unMark(e)}E.removeBy(e)}function Ea(e,c){if("_"!==c)return c&&c.startsWith("_")?c.substr(1):
e||c}function P(e,c,a,b){var d,f;if(e)if(e.nodeType){if(b=e,e=j.trim(j(b).attr(m.subsAttr))){c=new P;c.elem=b;a=c;a:{for(b=j(b);(b=b.parent())&&b.length;)if(d=b.hmData("ns"),!k(d)){b=d;break a}b=""}a.ns=b;return new P(e,c)}}else{if(!c)return c=new P,c.elem={},new P(e,c);this.sub=[];this.pub=[];for(this.groups=[];f=Cb.exec(e);){var h=f[1],g=f[2];f=f[3];var w={key:g,value:f};h?this["$"==h?"pub":"sub"].push(w):"ns"==g?d=f:this.groups.push(w)}this.ns=D(D(c.ns,a),d);this.text=e;this.elem=c.elem;this.subscriptions=
c.subscriptions;c.elemGroup?this.elemGroup=c.elemGroup:(this.elemGroup=this,j(this.elem).hmData("ns",this.ns));this.options=Ea(c.options,b);this.importGroup();this.importSubscriptions("sub");this.importSubscriptions("pub");this.debug&&this.print()}else this.subscriptions=[]}function Fa(e){var c,a,b,d=j(e);if(!d.hmData("parsed")&&d.attr(m.subsAttr)){e=new P(e);c=e.subscriptions;e.preSub&&e.preSub();for(a=0;a<c.length;a++)b=c[a],g.sub(b.subscriber,b.publisher,b.eventTypes,b.handler,b.options,b.delegate);
e.postSub&&e.postSub();d.hmData("parsed",!0)}d.children().each(function(){Fa(this)})}function da(e,c,a){return l({},Ga,t(e)?e:{get:e,set:c,finalize:a})}function db(e){this.modelPath=e.publisher.path;this.e=e}function eb(e){e=e||F.defaultEngine;if(!e)throw"engine name is not specified or default engine name is null";e=ua[e];if(!e)throw"engine '"+e+"' can not be found.";return e}function fb(e){e=e[0];return"true"==e.value?!0:"false"==e.value?!1:"on"!==e.value?e.value:e.checked}function gb(e,c,a,b){a:{var d,
f;if(a)for(d=ea.length-1;0<=d;d--){if(f=ea[d],f.name==a){a=f;break a}}else for(d=ea.length-1;0<=d;d--)if(f=ea[d],f.match&&f.match(e)){a=f;break a}a=void 0}if(!a||!a[b])throw"can not find "+b+" method for view";c[b+"ViewValue"]=a[b];a.convert&&(c.convert=a.convert);e.hmData("valueBound")||(a.initialize&&a.initialize(e),e.hmData("valueBound",!0))}function Db(e){var c=this.path;e=e.originalPublisher.path;var a=e.substr(c.length+1),b=a.indexOf("."),c=c+"."+a.substr(0,b)+".__state";e!==c&&g.get(c)==y.unchanged&&
g.set(c,y.modified)}function va(e,c){var a=e.get();return a.constructor[c](a).done(function(){e.set("__state","destroy"==c?y.detached:y.unchanged);e.trigger("afterSync."+c)})}function hb(e){if(""===e)return!ka.length;for(var c=e+".",a=0,b,d=ka.length;a<d;a++)if(b=ka[a],b==e||b.startsWith(c))return!1;return!0}function fa(e,c){return c?function(a){return!e.test(a)}:function(a){return e.test(a)}}function Q(e,c){return c.error||e.supplant(c)}function ib(e){var c=g(e+"*errors");c.isEmpty()||(c.clear(),
wa.removeItem(e))}function Eb(e){return{initialize:e.initialize,get:function(c){var a,b,d=c.publisher;a=c.workflow.options;var f=c.proposed;c=e.name&&m.errors[e.name];if(e.buildError)c=e.buildError(c,a);else{var h=t(a)?a.error:a;c=c&&c.contains("{0}")?c.format.apply(c,h.split(",")):h||c||e.error}if(null===f||f===u||jb.test(f)){a:{a=g(d.path).subsToMe();for(f=0;f<a.length;f++)if(a[f].workflow.get===Fb){a=!0;break a}a=!1}a?(a=!1,b=!0):a=!0}else a=e.isValid(f,a);a?d.removeError(c):!b||"required"===e.name?
d.addError(c):d.removeError(c)}}}function kb(e,c){for(var a=g.subscription.getAll(),b={},d=a.length-1,f,h;0<=d;d--)f=a[d],h=f.publisher,n(h)&&(!b[h]&&h.startsWith(e)&&f.eventTypes.contains("checkValidity"))&&(b[h]=!0,c(h))}function Gb(e){var c;c=e.publisher;if(1===e.level){c=c.get().table;for(var a in c)if(c[a]==e.removed){this.set(a,e.proposed);break}}else if(2<=e.level){a=e.originalPublisher.path.substr(c.path.length+1);var b=a.substr(0,a.indexOf("."));j.isNumeric(b)&&(a="table."+c.keyAt(b)+a.substr(a.indexOf(".")),
c.trigger(a,"afterUpdate",e.proposed,e.removed))}}function Hb(e){this.set("c"+e.publisher.get().guid++,e.proposed)}function Ib(e){var c=this.get();e=e.removed;for(var a in c)if(c[a]===e){this.del(a);break}}function Jb(e){this.removeItem(e.removed)}function Kb(e){this.replaceItem(e.removed,e.proposed)}function Ha(e){this.selectedIndex=e}function lb(e){this.set(e.publisher.attr(e.workflow.options));e.preventDefault();e.stopPropagation()}var g=x.hm=function(e,c){return new Ia(e,c)},Ia=function(e,c){this.path=
I(e||"",!0);k(c)||this.set(c)},R=x.document,Ja=x.localStorage,T=x.setTimeout,mb=x.history,nb=x.location,Lb=x.alert,Mb=x.confirm,U=x.matrix,J,l=j.extend,Ka={},z=j.isArray,r=j.isFunction,Nb={undefined:u,"boolean":u,number:u,string:u},H="__hm",Sa=/^__hm\.([^\.]+?)(?:\.|$)/,Ob=/this\.(?:get)\s*\(\s*(['"])([\*\.\w\/]+)\1\s*\)/g,M={},m={},p,O=Ka[H]={},Pb=Ka.hasOwnProperty,Aa=x.Array,ob=Aa.prototype,Qb=String.prototype,s=ob.slice,q,Rb=/^(?:\{.*\}|\[.*\])$/,Sb=/^\.(\.*)([\.\*])/,Tb=/^\.<(.*)/,pb=/^[\.\*]/,
Ub=/[\.\*]/,Vb=/#+|\./g,Ba=/#+/g,C=x.RegExp,zb=/^(.+)[\.\*]\w+$/,D,Wb=/^.+\.(\w+)$|\w+/,K,k,L,n,t,ga,La=j.isNumeric,S,la,I,G,Ma,ca=j.fn,ha,Xb=/\{([^\{\}]*)\}/g;Qa(ob,{indexOf:function(e,c){for(var a=c||0;a<this.length;a++)if(this[a]==e)return a;return-1},contains:function(e){return-1!==this.indexOf(e)},remove:function(e){e=this.indexOf(e);-1!=e&&this.splice(e,1);return this},removeAt:function(e){this.splice(e,1);return this},pushUnique:function(e){this.contains(e)||this.push(e);return this},merge:function(e){if(e&&
e.length)for(var c=0;c<e.length;c++)this.pushUnique(e[c]);return this},sortObject:function(e,c){k(c)&&(k(e)?(c=!0,e=u):n(e)?c=!0:(c=e,e=u));e?this.sort(function(a,b){var d=a[e],f=b[e];return d==f?0:c?d>f?1:-1:d>f?-1:1}):c?this.sort():this.sort().reverse();return this}});Qa(Qb,{startsWith:function(e){return 0===this.indexOf(e)},contains:function(e){return-1!==this.indexOf(e)},endsWith:function(e){return-1!==this.indexOf(e,this.length-e.length)},supplant:function(e){return this.replace(Xb,function(c,
a){var b=e[a];return typeof b?b:c})},format:function(){var e=this;j.each(arguments,function(c,a){e=e.replace(new C("\\{"+c+"\\}","g"),a)});return e}});J=Ia.prototype=g.fn=g.prototype={constructor:Ia,get:function(e){var c;if(c=this.accessor(e,!0)){if(r(c.hostObj))return c.hostObj.apply(this.cd(".."),s.call(arguments));c=!c.index?c.hostObj:c.hostObj[c.index];return r(c)?c.apply(this.cd(e).cd(".."),s.call(arguments,1)):c}},getJson:function(){return JSON.stringify(this.get.apply(this,s.call(arguments)))},
raw:function(e,c){var a;r(e)&&(c=e,e="");if(c)return a=this.accessor(e),a.index in a.hostObj?this.update(e,c,a):this.create(e,c,a);if(a=this.accessor(e,!0))return!a.index?a.hostObj:a.hostObj[a.index]},set:function(e,c,a){if(1==arguments.length){if(""===this.path)throw"root object can not changed";p.set(this.path,e,c);return this}var b=s.call(arguments);if(ga(e)){if(2==arguments.length)return p.set(e,this.path,c),this}else a=c,c=e,e=!1;var d=this.accessor(c),f=d.hostObj[d.index];return r(f)?(f.apply(this.cd(c).cd(".."),
s.call(b,1)),this):d.index in d.hostObj?this.update(e,c,a,d):this.create(e,c,a,d)},accessor:function(e,c){0===e&&(e="0");var a,b,d=Ka,f=this.getPath(e),h=I(f,!0),g=h.split(".");if(1===g.length)b=h;else{b=g[g.length-1];for(a=0;a<g.length-1&&!(d=d[g[a]],d===u);a++);}if(L(d)){if(c)return;throw"invalid update on unreachable node '"+G(f)+"'";}return{physicalPath:h,hostObj:d,index:b}},create:function(e,c,a,b){ga(e)||(b=a,a=c,c=e,e=!1);b=b||this.accessor(c);c=b.physicalPath;var d=b.hostObj,f=b.index,h=z(d);
if(h&&La(f)){if(f>d.length)throw"you can not add item with hole in array";}else if(f in d)throw"value at path: '"+G(b.physicalPath)+"' has been defined, try use update method instead";if(!e&&q(c,c,"beforeCreate",a).hasError())return!1;h&&La(f)?f==d.length?d[f]=a:f<d.length&&d.splice(b.index,0,a):d[b.index]=a;q(c,c,"afterCreate",a);Da(c,a);return this},extend:function(e,c){var a;c?a=this.cd(e):(c=e,a=this);for(var b in c)a.set(b,c[b]);return this},update:function(e,c,a,b){if(1==arguments.length){if(""===
this.path)throw"root object can not updated";p.update(this.path,e);return this}if(ga(e)){if(2==arguments.length)return p.update(e,this.path,c),this}else b=a,a=c,c=e,e=!1;b=b||this.accessor(c);if(!(b.index in b.hostObj))throw"value at path: '"+G(b.physicalPath)+"' has been not defined, try use create method instead";var d=b.physicalPath,f=b.hostObj[b.index];if(f==a)return this;if(!e&&q(d,d,"beforeUpdate",a,f).hasError())return!1;b.hostObj[b.index]=a;e||q(d,d,"afterUpdate",a,f);Da(d,a);return this},
del:function(e){if(k(e)){if(this.path)return p.del(this.path);throw"root can not be deleted";}var c=this.accessor(e),a=c.hostObj;e=c.physicalPath;var b=a[c.index],d=z(a);if(q(e,e,"beforeDel",u,b).hasError())return!1;d?a.splice(c.index,1):delete a[c.index];for(c=0;c<xa.length;c++)xa[c](e,b);q(e,e,"afterDel",u,b);return b},createIfUndefined:function(e,c){if(k(c))throw"missing value argument";var a=this.accessor(e);return a.index in a.hostObj?this:this.create(e,c,a)},pushStack:function(e){e.previous=
this;return e},cd:function(e){return this.pushStack(g(this.getPath(e)))},parent:function(){return this.cd("..")},shadow:function(){return this.cd("*")},sibling:function(e){return this.cd(".."+e)},main:function(){return this.pushStack(g(Ra(this.path)))},getPath:function(e){return D(this.path,e)},logicalPath:function(e){return G(this.getPath(e))},physicalPath:function(e){return I(this.getPath(e))},pathContext:function(){return Va(this.path)},pathIndex:function(){var e=Wb.exec(this.path);return e[1]||
e[0]},invoke:function(e){if(0===arguments.length)throw"methodName is missing";var c=this.get();return c[e].apply(c,s.call(arguments,1))},indexOf:function(e){return this.get().indexOf(e)},contains:function(e){return-1!==this.indexOf(e)},first:function(e){return e?this.filter(e)[0]:this.get("0")},last:function(){var e=this.get();return e[e.length-1]},push:function(e){return this.create(this.get().length,e)},pushRange:function(e){for(var c=0;c<e.length;c++)this.push(e[c]);return this},pushUnique:function(e){return!this.contains(e)?
this.push(e):this},pop:function(){return this.removeAt(this.get().length-1)},shift:function(){return this.del(0)},unshift:function(e){return this.create(0,e)},insertAt:function(e,c){return this.create(e,c)},updateAt:function(e,c){return this.update(e,c)},removeAt:function(e){return this.del(e)},move:function(e,c){var a=this.count();e!==c&&(0<=e&&e<a&&0<=c&&c<a)&&(a=this.del(e),this.insertAt(c,a),q(this.path,this.path,"move",c,e));return this},replaceItem:function(e,c){if(e==c)return this;var a=this.indexOf(e);
return-1!=a?this.updateAt(a,c):this},removeItem:function(e){e=this.indexOf(e);return-1!==e?this.removeAt(e):this},removeItems:function(e){for(var c=0;c<e.length;c++)this.removeItem(e[c]);return this},clear:function(){var e=this.get(),c=e.splice(0,e.length);q(this.path,this.path,"afterCreate",e,c);return this},count:function(){return this.get().length},filter:function(e){return j(this.get()).filter(e).get()},each:function(e,c){ga(e)||(c=e,e=!1);var a,b,d,f;if(e){f=this.get();for(b=f.length-1;0<=b;b--)if(d=
c(b,f[b],f),!0===d)a=!0;else if(!1===d)break;a&&this.triggerChange()}else for(b=this.count()-1;0<=b&&!(a=this.cd(b),!1===c.call(a,b,a,this));b--);return this},map:function(e){return j.map(this.get(),e)},sort:function(e,c){return q(this.path,this.path,"afterUpdate",this.get().sortObject(e,c))},reference:function(){for(var e=0;e<arguments.length;e++)Ta(this.path,arguments[e]);return this},dereference:function(){for(var e=0;e<arguments.length;e++)Ua(this.path,arguments[e]);return this},isEmpty:function(e){e=
this.get(e);return!e?!0:!z(e)?!1:0===e.length},isShadow:function(){return this.path.startsWith(H)},toJSON:function(e){return JSON.stringify(this.get(e))},compare:function(e){if(e)if(e=la(e),n(e)){if(this.get()==e)return!0;try{return eval("this.get()"+e)}catch(c){return!1}}else return this.get()==e;else return this.isEmpty()},saveLocal:function(e){K.local(this.getPath(e),this.get());return this},getLocal:function(e){return K.local(this.getPath(e))},restoreLocal:function(e){p.set(this.getPath(e),this.getLocal(e));
return this},clearLocal:function(e){K.local(this.getPath(e),u);return this}};var X=[function(e,c,a){if(r(a)&&(!a.name||!a.name.startsWith("_"))){c=e?e+"."+c:c;var b=a.toString(),d;for(a=[];d=Ob.exec(b);)a.pushUnique(d[2]);for(b=0;b<a.length;b++)Ta(c,e?D(e,a[b]):a[b])}}],$={},Na=function c(a){var b;if(!(this instanceof c))return b=new c($),c.apply(b,arguments);if(arguments[0]===$)return this;this.initialize.apply(this,arguments);return this},ia;l(Na.prototype,{callProto:function(c){return this.constructor.prototype[c].apply(this,
s.call(arguments,1))},callBase:function(c){ia=ia||this;if(ia=ia.constructor.__super__){var a=ia[c].apply(this,s.call(arguments,1));ia=null;return a}},initialize:function(c){l(this,c)},toJSON:function(){var c=l(!0,{},this),a;for(a in c)a.startsWith("__")&&delete c[a];return c}});l(Na,{list:function(c){var a,b,d=[],f;if(!k(c))if(z(c)){f=c.itemIsObject;for(a=0;a<c.length;a++)b=c[a],d.push(f||!z(b)?new this(b):this.apply(null,b))}else d.push(c);return d},extend:function(c,a){var b,d=this;b=c&&c.hasOwnProperty("constructor")?
c.constructor:function v(){var a;if(!(this instanceof v))return a=new v($),v.apply(a,arguments);if(arguments[0]===$)return this;d.apply(this,arguments);return this};l(b,d,a);var f=function(){this.constructor=b};f.prototype=d.prototype;b.prototype=new f;c&&l(b.prototype,c);b.__super__=d.prototype;return b}});l(g,{Class:Na,util:K={toPhysicalPath:I=function(c,a){for(var b,d="",f="",h;b=Ub.exec(c);)c=C.rightContext,f=C.leftContext,"."==b[0]?d?(d==H&&(a&&!O[f])&&(h=f.replace(Ba,Ca),k(p.get(h))||(O[f]=
{})),d=d+"."+f):d=f:(d?(b=(d?d.replace(Vb,yb):d)+"#"+f,h=d+"."+f):h=f?b=f:b="",d=H+(b?"."+b:""),a&&(!O[b]&&d!=H&&!k(p.get(h)))&&(O[b]={}));return!c?d:d?d+"."+c:c},toLogicalPath:G=function(c){var a;return c===H?"*":(a=Sa.exec(c))?(c=C.rightContext,a=a[1].replace(Ba,Ca),G(a+"*"+c)):c},mergePath:D=function(c,a,b){if("_"==a||"_"==c)return"_";c=I(c);if(!k(a)&&null!==a&&(a+="",a.startsWith("/")))return a.substr(1);k(b)&&(b=!0);b&&(a&&c&&!pb.test(a))&&(a="."+a);if(!a||"."==a)return c;if(pb.test(a)){if(b=
Sb.exec(a)){a=1+(b[1]?b[1].length:0);for(var d=C.rightContext;a;)c=Va(c),a--;return d?c?c+b[2]+d:d:"*"===b[2]?c+"*":c}if(b=Tb.exec(a))return D(Ra(c),b[1])}else return a;return c+a},isUndefined:k=function(c){return c===u},isPrimitive:L=function(c){return null===c||typeof c in Nb},isString:n=function(c){return"string"===typeof c},isObject:t=function(c){return"object"===j.type(c)},isBoolean:ga=function(c){return"boolean"===typeof c},toTypedValue:la=function(c){if(n(c)){c=j.trim(c);try{c="true"===c?!0:
"false"===c?!1:"null"===c?null:"undefined"===c?u:La(c)?parseFloat(c):Rb.test(c)?j.parseJSON(c):c}catch(a){}}return c},isPromise:S=function(c){return!(!c||!c.promise||!c.done||!c.fail)},clearObj:Ma=function(c){if(L(c))return null;for(var a in c)Pb.call(c,a)&&(c[a]=Ma(c[a]));return c},clone:ha=function(c,a){return L(c)?c:z(c)?c.slice(0):r(c)?c:l(!!a,{},c)},local:function(c,a){if(1==arguments.length)return JSON.parse(Ja.getItem(c));k(a)?Ja.removeItem(c):Ja.setItem(c,JSON.stringify(a))},toString:function(c){return null===
c||c===u?"":""+c},encodeHtml:function(c){var a=R.createElement("div");a.appendChild(R.createTextNode(c));return a.innerHTML},_referenceTable:M},onAddOrUpdateNode:function(c){return c?(X.push(c),this):X},onDeleteNode:function(c){return c?(xa.push(c),this):xa},options:m});var xa=[function(c){var a,b,d=G(c);for(a in M)Ua(c,a);for(a in M)a.startsWith(c)&&delete M[a];for(b in O)c=H+"."+b,a=G(c),(a==d||a.startsWith(d+"*")||a.startsWith(d+"."))&&p.del(c)}];j(["get","set","del","extend"]).each(function(c,
a){g[a]=function(){return p[a].apply(p,s.call(arguments))}});p=g();ca.hmData=function(c,a){var b=this.data("hmData");if(0===arguments.length)return b;if(1===arguments.length)return b&&b[c];k(b)&&this.data("hmData",b={});b[c]=a};var ba,Z=/[ ]+/,$a=/\*\.$/,Bb=/\.|\*/g,E,Yb=0,Zb=/init(\d*)/,sa=["get","set","convert","finalize","initialize"];pa.prototype={constructor:pa,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=
A},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=A},stopCascade:function(){this.isCascadeStopped=A},error:function(){this.hasError=A},isCascadeStopped:oa,isPropagationStopped:oa,isImmediatePropagationStopped:oa,hasError:oa,level:0};q=function(c,a,b,d,f){d=new pa(c,a,b,d,f);Za(d);if(!d.isPropagationStopped()&&d.publisher.path){d.isDependent()&&(d.originalPublisher.path=d.publisher.path);do d.publisher.path=d.publisher.pathContext(),
d.level++,d.type=d.originalType+"."+d.level,Za(d);while(!d.isPropagationStopped()&&d.publisher.path)}d.type=b;d.originalPublisher.path=a;d.publisher.path=c;return d};var Oa=function(c,a){n(c)&&(c=I(c));for(var b=[],d=0,f;d<V.length;d++)f=V[d],a(f,c)&&b.push(f);return b},V=[];E={getByPublisher:function(c){return Oa(c,function(a,b){return a.publisher==b})},getBySubscriber:function(c){return Oa(c,function(a,b){return a.subscriber==b})},getBy:function(c){return Oa(c,function(a,b){return a.subscriber==
b||a.publisher==b})},getAll:function(){return V},add:function(c,a,b,d){if(n(a))for(var f=b.split(Z),h=0;h<f.length;h++){var g=this.special[f[h]];g&&g.setup&&g.setup(c,a)}V.push({publisher:a,subscriber:c,eventTypes:b,workflow:d})},removeBy:function(c){var a,b,d,f=[];for(a=V.length-1;0<=a;a--)if(d=V[a],b=d.workflow,c===d.publisher||c===d.subscriber||n(c)&&(n(d.publisher)&&d.publisher.startsWith(c+".")||n(d.subscriber)&&d.subscriber.startsWith(c+".")))n(d.publisher)||(b.delegateSelector?j(d.publisher).undelegate(b.delegateSelector,
d.eventTypes,aa):j(d.publisher).unbind(d.eventTypes,aa)),f.push(V.splice(a,1)[0]);for(a=f.length-1;0<=a;a--)if(d=f[a],n(d.publisher)){var h=d.eventTypes.split(Z);for(c=0;c<h.length;c++)(b=this.special[h[c]])&&b.teardown&&b.teardown(d.subscriber,d.publisher)}},special:{}};l(g,{trigger:q,subscription:E,sub:function(c,a,b,d,f,h){c instanceof g&&(c=c.path);a instanceof g&&(a=a.path);n(c)&&c.startsWith("$")&&(c=j(c.substr(1)));if(c&&c.jquery)if(!c.length&&!c.selector)c=null;else{c.each(function(c,j){g.sub(j,
a,b,d,f,h)});return}n(a)&&a.startsWith("$")&&(a=j(a.substr(1)));if(a&&a.jquery)a.each(function(a,j){g.sub(c,j,b,d,f,h)});else{if(!a&&""!==a)throw"publisher can not be null";if(!b)throw"eventTypes can not be null";if("_"===c||"null"==c||null===c)c=$;"_"===f&&(f=u);var v=n(a),w=n(c);Y.mark(a);Y.mark(c);v&&(a=I(a));w&&(c=I(c));if(v){var k=a,l=b,p=c,v=f,m,r,t,q;q=l.split(" ");for(var s=0;s<q.length;s++)if(w=Zb.exec(q[s])){r=q[s];m=+w[1];q.splice(s,1);l=q.join(" ");break}t=ab(d,k,p,v);l&&E.add(p,k,l,t);
r&&(l=function(){var a=new pa(k,k,r);qa(N(p),t,a)},m?T(l,m):l())}else m=a,v=b,w=c,q=f,s=v.split(" "),s.contains("init")&&(l=!0,v=s.remove("init").join(" ")),s=ab(d,m,w,q),q={workflow:s,subscriber:w},v?(v=Ya(v,m,w),h?(s.delegateSelector=h,j(m).delegate(h,v,q,aa)):j(m).bind(v,q,aa),E.add(w,m,v,s),l&&(h?j(m).find(h).trigger(v):j(m).trigger(v))):l&&(j(m).one("init",q,aa),j(m).trigger("init"))}},handle:function(){return this.sub.apply(this,[null].concat(s.call(arguments)))},workflowType:function(c,a){if(t(c))for(var b in c)ba[b]=
bb(c[b]);else return k(c)?ba:k(a)?ba[c]:ba[c]=bb(a)},activity:{initialize:{},get:{getMember:Wa,getOriginal:function(c){return c.originalPublisher.get()},skipGet:A},set:{setMember:Xa,skipSet:j.noop},convert:{toString:K.toString,toTypedValue:K.toTypedValue,toNumber:function(c){return+c},toDate:function(c){return new Date(c)}},finalize:{}}});ba={triggerChange:{get:function(c){p.triggerChange(c.workflow.options)}},saveLocal:{get:function(c){var a=c.publisher.path;T(function(){g(a).saveLocal()},1)}}};
var Y={getId:function(c){return j(c).hmData("viewId")},unMark:function(c){j(c).hmData("viewId",u)},mark:function(c){t(c)&&!j(c).hmData("viewId")&&j(c).hmData("viewId",++Yb)}};g.onDeleteNode(cb);l(J,{trigger:function(c,a,b,d){if(!arguments.length)throw"missing arguments";3>=arguments.length&&(d=b,b=a,a=c,c="");var f=this.physicalPath(c);q(f,f,a,b,d);return this},triggerChange:function(c){var a=this.physicalPath(c);c=this.get(c);q(a,a,"afterUpdate",c,c);return this},sub:function(c,a,b,d,f){g.sub(this.path,
c,a,b,d,f);return this},handle:function(c,a,b,d){g.sub(null,this,c,a,b,d);return this},subBy:function(c,a,b,d,f){g.sub(c,this.path,a,b,d,f);return this},subsToMe:function(){return E.getByPublisher(this.path)},subsFromMe:function(){return E.getBySubscriber(this.path)},subscriptions:function(){return E.getBy(this.path)},mapEvent:function(c,a,b){b=b||A;g.handle(this.path,c,function(c){b.call(this,c)&&c.publisher.trigger(a,c.proposed,c.removed)});return this},cacheable:function(c){g.handle(this.getPath(c),
"init after*","*saveLocal");return this}});l(ca,{sub:function(c,a,b,d,f){this.length&&g.sub(this,c,a,b,d,f);return this},handle:function(c,a,b,d){this.length&&g.sub(null,this,c,a,b,d);return this},subBy:function(c,a,b,d,f){this.length&&g.sub(c,this,a,b,d,f);return this},subsToMe:function(){return E.getByPublisher(this[0])},subsFromMe:function(){return E.getBySubscriber(this[0])},subscriptions:function(){return E.getBy(this[0])},initView:function(c,a,b){g.sub(this,c,"init",a,b);return this},mapEvent:function(c,
a,b,d){b?r(b)||(d=b,b=A):b=A;return this.handle(c,function(c){b.call(this,c)&&(c.type=a,c.eventData=d,c.publisher.trigger(c))})}});g.newViewEvent=function(c,a,b){if(t(c)){for(var d in c)g.newViewEvent(d,c[d][0],c[d][1]);return this}var f=function(a){(!0===b||b.call(this,a))&&j(a.target).trigger(l({},a,{type:c,currentTarget:a.target}))};if(j.event.special[c])throw"event '"+c+"' has been defined";j.event.special[c]={setup:function(){j(this).bind(a,f)},teardown:function(){j(this).unbind(a,f)}};return this};
var $b=j.cleanData;j.cleanData=function(c){j(c).each(function(){cb(this)});$b(c)};K.getUniqueViewEventTypes=Ya;K._viewHandlerGateway=aa;var Cb=/([!$]?)([\w \+\-\*\.]+?):([\w\W]+?)\s*(?:[;]\s*|$)/g,ac=/^([^|]+)(\|(.*))?$/,bc=/\s*\|\s*/g;m.subsAttr="data-sub";m.autoparseSub=!0;P.prototype={importGroup:function(){var c,a,b,d,f=this.groups;for(c=0;c<f.length;c++)b=f[c],a=b.key,d=ac.exec(b.value),b=d[1],d=d[3],a=g.groups[a],r(a)?a(this.elem,D(this.ns,b),this,Ea(this.options,d)):n(a)&&new P(a,this,b,d)},
importSubscriptions:function(c){var a,b,d,f,h,g=this[c];for(a=0;a<g.length;a++)b=g[a],f=b.key,b=b.value.split(bc),"sub"==c?(d=b[0],d=d.startsWith("$")?d:D(this.ns,d),h=this.elem):(d=this.elem,h=b[0],h=h.startsWith("$")?h:D(this.ns,h)),this.appendSub(h,d,f,b[1],la(Ea(this.options,b[2])),b[3])},appendSub:function(c,a,b,d,f,h){this.subscriptions.push({publisher:a,eventTypes:b,subscriber:c,handler:d,options:f,delegate:h})},prependSub:function(c,a,b,d,f,h){this.subscriptions.unshift({publisher:a,eventTypes:b,
subscriber:c,handler:d,options:f,delegate:h})},clearSubs:function(){this.subscriptions.splice(0,this.subscriptions.length)}};T(function(){j(function(){m.autoparseSub&&Fa(R.documentElement)})},1);ca.parseSub=function(){return this.each(function(){Fa(this)})};var qb=g("*log",[]);l(g,{groups:{code:function(c,a,b,d){p.get(a,c,a,b,d)},preSub:function(c,a,b,d){b.preSub=function(){p.get(a,c,a,b,d)}},postSub:function(c,a,b,d){b.postSub=function(){p.get(a,c,a,b,d)}}},Group:P,log:function(c,a){qb.push(a?"<div style='color:"+
a+"'>"+c+"</div> ":c)},clearlog:function(){qb.clear()}});var F,ua={},Ga={initialize:"*templateOptions",get:"get",convert:"*dataToMarkup",set:"html",finalize:"*parseSub"};g.activity.initialize.templateOptions=function(c,a,b,d){if(n(d))d=d.split(","),b.templateId=j.trim(d[0]),b.wrapDataInArray="true"==j.trim(d[1]),b.engineName=d[2];else if(t(d)&&d.templateId)l(b,d);else if(!(b.templateId=a.hmData("embeddedTemplate")))if(c=j.trim(a.html()))c=c.replace(cc,dc),b.templateId="__"+j.uuid++,F.compile(b.templateId,
c),a.hmData("embeddedTemplate",b.templateId),a.empty();else throw"missing template";};var cc=/&lt;|&gt;/g,ec={"&lt;":"<","&gt;":">"},dc=function(c){return ec[c]||""};db.prototype.get=function(){var c=this.e.publisher;return c.get.apply(c,s.call(arguments))};g.activity.convert.dataToMarkup=function(c,a){if(c&&(z(c)&&c.length||!z(c))){var b=a.workflow,d;var f=b.templateId,h=b.wrapDataInArray?[c]:c;d=new db(a);var g=eb(b.engineName,f),f=j.trim(f);if(g.isTemplateLoaded(f))d=g.render(f,h,d);else if(g.renderAsync)d=
g.renderAsync(f,h,d);else{var w=j.Deferred(),b=l(!0,{},d.e),k=l(!0,{},b.publisher),m=l(!0,{},d);b.publisher=k;m.e=b;F.load(f).done(function(){var a=g.render(f,h,m),b=j(a);w.resolve(b.selector||!b.length?a:b)});d=w.promise()}if(S(d))return d;n(d)&&(d=j.trim(d));return j(j("<div />").html(d)[0].childNodes)}return""};g.activity.finalize.parseSub=function(c){j(c).parseSub()};g.workflowType({renderContent:Ga,renderSelf:da("get","replaceWith")});l(g.groups,{"for":"!init:.|*renderContent",forSelf:"!init after*.:.|*renderContent",
forChildren:"!init after*. after*.1:.|*renderContent",forAll:"!init after*:.|*renderContent",renderSelf:"!init:.|*renderSelf"});ca.renderContent=function(c,a,b){a=a||"";r(b)&&(b={finalize:b});return this.initView(a,b?l({},Ga,b):"*renderContent",c)};ca.renderSelf=function(c,a,b){r(b)&&(b={finalize:b});return this.initView(a,b?l({},g.workflowType("renderSelf"),b):"*renderSelf",c)};g.template=F={defaultEngine:"",engineAdapter:function(c,a){if(!c)return ua;if(!a)return ua[c];a.isTemplateLoaded=a.isTemplateLoaded||
A;ua[c]=a;F.defaultEngine=c},load:function(){throw"not implemented";},compile:function(c,a,b){return eb(b).compile(c,a)},newTemplateWorkflow:da};if(j.render&&j.templates){var Pa;F.engineAdapter("jsrender",Pa={render:function(c,a,b){j.render[c]||this.compile(c,R.getElementById(c).innerHTML);return j.render[c](a,b)},compile:function(c,a){j.templates(c,{markup:a,debug:Pa.templateDebugMode,allowCode:Pa.allowCodeInTemplate})},isTemplateLoaded:function(c){return!!j.render[c]||!!R.getElementById(c)},templateDebugMode:!1,
allowCodeInTemplate:!0});var rb=j.views.tags;rb({ts:function a(){return a.enabled?"<span style='color:red' data-sub='show:/*ts'>updated on:"+(+new Date+"").substring(7,10)+"</span>":""},indexToNs:function(){var a=this.tagCtx.view.index,b=this.ctx.modelPath;k(a)&&(a=this.ctx.e.publisher.count()-1);return"ns:/"+b+"."+a},get:function(){var a=this.ctx.e.publisher;return a.get.apply(a,s.call(arguments))},prop:function(){var a=this.tagCtx.view.index;k(a)&&(a=this.ctx.e.publisher.count()-1);a=this.ctx.e.publisher.cd(a);
return a.get.apply(a,s.call(arguments))},keyToNs:function(){return"ns:/"+this.ctx.modelPath+".table."+this.ctx.e.publisher.itemKey(this.tagCtx.view.data)},dataPathAsNs:function(){return"ns:/"+this.ctx.modelPath}});rb.ts.render.enabled=!0;g("*ts",!1)}var B=x.Handlebars;k(B)||(g.template.engineAdapter("handlebars",{render:function(a,b,d){return B.partials[a](b,{data:{renderContext:d}})},compile:function(a,b){B.registerPartial(a,B.compile(b))},isTemplateLoaded:function(a){return!!B.partials[a]}}),B.registerHelper("modelPath",
function(a){return a.data.renderContext.modelPath}),B.registerHelper("indexToNs",function(a){return"ns:/"+a.data.renderContext.modelPath+"."+a.data.index+";"}),B.registerHelper("keyToNs",function(a){a=a.data.renderContext;return"ns:/"+a.modelPath+".table."+a.e.publisher.itemKey(this)}),B.registerHelper("get",function(){var a=arguments,b=a.length-1,d=a[b].data.renderContext;return d.get.apply(d,s.call(a,0,b))}),B.registerHelper("prop",function(){var a=[].slice,b=arguments,d=b.length-1,f=b[d].data,
f=f.renderContext.e.publisher.cd(f.index);return f.get.apply(f,a.call(b,0,d))}),j(function(){j("script[type=handlebars]").each(function(){B.registerPartial(this.id,B.compile(j(this)[0].innerHTML))})}));var ea=[{name:"textBoxOrDropDown",get:function(a){return a.val()},set:function(a,b){a.val()!==b&&a.val(b)},match:A},{name:"checkbox",get:fb,set:function(a,b){var d=a[0];d.checked=ga(b)?b:b==d.value},match:function(a){return a.is(":checkbox")}},{name:"radio",get:fb,set:function(a,b,d){a=a[0];a.name||
(a.name=d.publisher.path);a.checked=K.toString(b)==a.value},match:function(a){return a.is(":radio")}},{name:"listBox",get:function(a){var b=[];a.children("option:selected").each(function(){b.push(this.value)});return b},set:function(a,b){function d(){this.value==h&&(this.selected=!0)}a.children("option:selected").removeAttr("selected");for(var f=0,h;f<b.length;f++)h=b[f],a.children("option").each(d)},match:function(a){return a.is("select[multiple]")}}];g.activity.get.getViewValue=function(a){return a.workflow.getViewValue(a.publisher)};
g.activity.set.setViewValue=function(a,b){return b.workflow.setViewValue(this,a,b)};g.workflowType({updateViewValue:{initialize:function(a,b,d,f){gb(b,d,f,"set")},get:"get",set:"*setViewValue"},updateModelValue:{initialize:function(a,b,d,f){gb(a,d,f,"get")},get:"*getViewValue",set:"set"}});g.valueAdapter=function(a){if(a)ea.push(a);else return ea};g.groups.val=function(a,b,d,f){var h,g,j;(f=f||"")?(f=f.split(","),g=f[0]||"change",h=f[1],j=f[2]):g="change";(!h||"updateView"==h)&&d.appendSub(a,b,"init1 after*",
"*updateViewValue",j);(!h||"updateModel"==h)&&d.appendSub(b,a,g+" resetVal","*updateModelValue",j)};g.groups.resetFormValues=function(a){function b(){d.find(":input").trigger("resetVal")}var d=j(a);d.bind("reset",function(){T(b,1)})};m.confirmMessage="Are you sure?";g.activity.get.compareTruthy=function(a){var b=a.workflow.options;a=a.publisher;return k(b)?!a.isEmpty():a.compare(b)};g.activity.initialize.extractClass=function(a,b,d,f){a=f.split(",");d.className=a[0];d.options=a[1]};var sb={options:["!init after*:.|*options",
{get:function(a){var b=a.workflow.options,d=this.val();this.children("option[listItem]").remove().end().append(function(){var d="";j(a.publisher.get()).each(function(){d+="<option listItem='1' value='"+b.value(this)+"'>"+b.name(this)+"</option>"});return d}).val(d);this.val()!==d&&j(this.trigger("change"))},initialize:function(a,b,d,f){if(f){a=f.split(",");var h=a[0],g=a[1]||a[0];d.options={name:function(a){return a[h]},value:function(a){return a[g]}}}else d.options={name:function(a){return a.toString()},
value:function(a){return a.toString()}}}}],show:["!init after*:.|*show",{get:"*compareTruthy",set:function(a){this[a?"show":"hide"]()}}],hide:["!init after*:.|*hide",{get:"*compareTruthy",set:function(a){this[a?"hide":"show"]()}}],enable:["!init after*:.|*enable",{get:"*compareTruthy",set:function(a){this.attr("disabled",!a)}}],disable:["!init after*:.|*disable",{get:"*compareTruthy",set:function(a){this.attr("disabled",a)}}],addClass:["!init after*:.|*addClass",{initialize:"*extractClass",get:"*compareTruthy",
set:function(a,b){this[a?"addClass":"removeClass"](b.workflow.className)}}],removeClass:["!init after*:.|*removeClass",{initialize:"*extractClass",get:"*compareTruthy",set:function(a,b){this[a?"removeClass":"addClass"](b.workflow.className)}}],toggleClass:["!init after*:.|*toggleClass",{get:function(a){var b,d,f=a.publisher.get(),h=a.workflow.options;h&&(h.startsWith("!")&&(d=!0,h=h.substr(1)),b=f^d?"addClass":"removeClass");if("init"==a.type)if(h)this[b](h);else this.addClass(f);else if(h)this[b](h);
else this.removeClass(a.removed).addClass(f)}}],focus:["!init after*:.|*focus",{get:"*compareTruthy",set:function(a){if(a){var b=this;T(function(){b.focus().select()},1)}}}],count:["!init after*:.|*count",function(a){a=a.publisher.get();this.text("length"in a?a.length:a)}],dump:["!init *:.|*dump",function(a){a.type.startsWith("before")||this.html("<span style='color:red'>"+a.publisher.path+" : "+a.publisher.toJSON()+"</span>")}],alert:["$click:.|*alert",function(a){Lb(k(a.workflow.options)?this.get():
a.workflow.options)}],preventDefault:["$click:_|*preventDefault",function(a){a.preventDefault()}],stopPropagation:["$click:_|*stopPropagation",function(a){a.stopPropagation()}],confirm:[function(a,b,d,f){g.sub(b,a,"click","*confirm",f)},function(a){var b=k(a.workflow.options)?this&&this.get&&this.get()||m.confirmMessage:a.workflow.options;Mb(b)||(a.stopImmediatePropagation(),a.preventDefault&&a.preventDefault())}],hardCode:["$click:.|*hardCode",{initialize:function(a,b,d,f){d.hardCode=la(f)},get:function(a){this.set(a.workflow.hardCode)}}],
"0":["$click:.|*0",function(){this.set(0)}],emptyString:["$click:.|*empty",function(){this.set("")}],"null":["$click:.|*null",function(){this.set(null)}],"true":["$click:.|*true",function(){this.set(!0)}],"++":["$click:.|*++",function(){this.set(this.get()+1)}],"--":["$click:.|*--",function(){this.set(this.get()-1)}],"false":["$click:.|*false",function(){this.set(!1)}],toggle:["$click:.|*toggle",function(){this.set(!this.get())}],sortItems:["$click:.|*sortItems",{initialize:function(a,b,d,f){f=(f||
"")&&f.split(",");d.by=f[0];d.asc=!!f[1]},get:function(a){a=a.workflow;this.sort(a.by,a.asc);a.asc=!a.asc}}],clear:["$click:.|*clear",function(){this.clear()}],del:["$click:.|*del;confirm:_|_Do you want to delete this item?",function(){this.del()}]},ya;for(ya in sb){var tb=sb[ya];g.groups[ya]=tb[0];g.workflowType(ya,tb[1])}l(g.groups,{caption:function(a,b,d,f){j(a).prepend("<option value=''>"+(f||g.get(b))+"</option>")},autofocus:function(a){T(function(){j(a).focus()},1)},mapEvent:function(a,b,d,
f){f=f.split(",");j(a).mapEvent(f[0],f[1],f[2])},mapClick:function(a,b,d,f){f=f.split(",");j(a).mapEvent("click",f[0],f[1])},logPanel:function(a,b,d){a=j(a);var f=a.is("ol")?a:j("<ol style='font-family: monospace, serif' />").appendTo(a);a=f[0];d.appendSub(a,"*log","init",function(a){a=a.publisher.get();for(var b=0;b<a.length;b++)f.append("<li>"+a[b]+"</li>")});d.appendSub(a,"*log","afterCreate.1",function(a){f.append("<li>"+a.originalPublisher.raw()+"</li>")});d.appendSub(a,"*log","afterCreate",
function(){f.empty()})},clearlog:"clear:/*log",enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",html:"!init after*:.|get html *toString",text:"!init after*:.|get text *toString"});g.newViewEvent({enter:["keyup",function(a){return 13===a.keyCode}],esc:["keyup",function(a){return 27===a.keyCode}],ctrlclick:["click",function(a){return a.ctrlKey}]});var fc={create:"POST",update:"PUT",destroy:"DELETE",fetch:"GET"},y={detached:0,unchanged:1,added:3,deleted:4,modified:5};g.onAddOrUpdateNode(function(a,
b,d){d instanceof g.Entity&&(d.__state===y.detached&&(d.__state=y.added),k(g(a).get("__entityContainer"))&&(g.sub(a,a,"afterUpdate.*",Db),g(a).set("__entityContainer",!0)))});g.Entity=g.Class.extend({__state:y.detached,create:function(){if(this instanceof g){if(this.get("__state")==y.added)return va(this,"create");throw"entity is not a new item";}return this.constructor.create(this)},fetch:function(){return this instanceof g?va(this,"fetch"):this.constructor.fetch(this)},update:function(){if(this instanceof
g){if(this.get("__state")==y.modified)return va(this,"update")}else return this.constructor.update(this)},destroy:function(){if(this instanceof g){var a=this;return va(this,"destroy").done(function(){a.del()})}return this.constructor.destroy(this)},save:function(){if(this instanceof g){var a=this.get("__state");if(a==y.added)return this.get("create");if(a==y.modified)return this.get("update")}else throw"not supported";}},{state:y,create:function(a){return this.ajax("create",a)},update:function(a){return this.ajax("update",
a)},destroy:function(a){return this.ajax("destroy",a)},fetch:function(a){if(a)return this.ajax("fetch",a);var b=this;return this.ajax("fetch").pipe(function(a){return j(b.list(a)).each(function(){this.__state=y.unchanged}).get()})},getUrl:function(a,b){var d=this.url||b.url,f=b&&b.id;return f?d+("/"===d.charAt(d.length-1)?"":"/")+encodeURIComponent(f):d},ajax:function(a,b){var d=fc[a],d={type:d,dataType:"json",url:this.getUrl(a,b),contentType:"GET"==d?null:"application/json",processData:!1,data:"GET"==
d?null:JSON.stringify(b)};return j.ajax(d).done(function(a){b&&l(b,a)})}});l(J,{save:function(){return this.get("save")},destroy:function(){return this.get("destroy")},fetch:function(){return this.get("fetch")}});m.errors={defaultError:"Please enter a valid value"};var ka=O.invalidPaths=[],wa=g("*invalidPaths"),jb=/^\s*$/,ub=/^\d+$/,gc=/Invalid|NaN/,hc=/^(\/(\\[^\x00-\x1f]|\[(\\[^\x00-\x1f]|[^\x00-\x1f\\\/])*\]|[^\x00-\x1f\\\/\[])+\/[gim]*)(,(.*))*$/,ma=/([^,]+)(,(.*))?/,vb=/(\w+),(\w+)(,(.*))?/;
g.validator=function(a){if(z(a)){for(var b=0;b<a.length;b++)g.validator(a[b]);return this}b=a.name;if(g.workflowType(b))throw"validator name '"+b+"' collide with name in hm.workflowTypes";a.error&&(m.errors[b]=a.error);var d="v_"+b;g.workflowType(d,Eb(a));g.groups[b]="!afterUpdate checkValidity:.|*"+d};g.workflowType({checkValidity:function(a){g.checkValidity(this.path)||a.stopImmediatePropagation()},warn:function(a){a.publisher.isEmpty()?this.removeClass("error").next("span.error").remove():this.addClass("error").next("span.error").remove().end().after("<span class='error'>"+
a.publisher.get()+"</span>")},renderErrorSummary:g.template.newTemplateWorkflow(function(a){return[a.publisher.getErrors()]})});l(g.groups,{validator:function(a,b,d,f){if(!f)throw"missing validator path";f.startsWith("#")||(f="#"+f);g(b).validator(f)},checkValidity:function(a,b,d){d.prependSub(b,a,"click","*checkValidity")},resetFormValidity:function(a,b,d){d.appendSub(b,a,"reset","*skipGet resetValidity")},resetForm:"resetFormValidity:.;resetFormValues:.",resetValidity:"$click:.|*skipGet resetValidity",
warn:"!after*:*errors|*warn",warnSummary:"!afterUpdate* validityChecked:.|*renderErrorSummary;!validityReset:.|empty"});g.subscription.special.validityChanged={setup:function(a,b){var d=b+"*isValid";k(g.get(d))&&g.sub(b,"*invalidPaths","!after*. after*.1",function(){var a=hb(b);g.get(d)!==a&&(g.trigger(b,b,"validityChanged",a,!a),g.set(d,a))})}};l(J,{checkValidity:function(a){a=this.getPath(a);kb(a,function(a){q(a,a,"checkValidity",p.get(a))});var b=hb(a);g.trigger(a,a,"validityChecked",b);return b},
validator:function(a,b){var d,f;if(t(a))for(d in a)this.cd(d).validator(a[d]);else if(r(a)||n(a)&&a.startsWith("#"))n(a)&&(a=this.raw(a.substr(1))),g.handle(this.path,"afterUpdate* checkValidity",function(b){var d=b.publisher,f=a.previousError;null===b.proposed||b.proposed===u||jb.test(b.proposed)?f&&(d.removeError(f),a.previousError=""):(b=a(d.get()),!1===b&&(b=m.errors.defaultError),n(b)?b!=f&&(d.addError(b),f||d.removeError(f),a.previousError=b):f&&(d.removeError(f),a.previousError=""))});else if(n(a))g.handle(this.path,
"afterUpdate* checkValidity","*v_"+a,b);else if(z(a))for(d=0;d<a.length;d++)f=a[d],z(f)?this.validator(f[0],f[1]):this.validator(f);return this},resetValidity:function(){ib(this.path);L(this.get())||kb(this.path,ib);g.trigger(this.path,this.path,"validityReset")},addError:function(a){this.createIfUndefined("*errors",[]).cd("*errors").pushUnique(a);wa.pushUnique(this.path);return this},removeError:function(a){var b=this.createIfUndefined("*errors",[]).cd("*errors");b.removeItem(a);b.isEmpty()&&wa.removeItem(this.path);
return this},getErrors:function(){var a,b=this.path,d,f=[];for(a=0;a<ka.length;a++)if(d=ka[a],d==b||d.startsWith(b))f=f.concat(g.get(d+"*errors"));return f}});g.checkValidity=function(a){return p.checkValidity(a)};g.onDeleteNode(function(a){wa.removeItem(a)});g.validator.defaultErrorBuilder=Q;g.validator.buildRegexFn=fa;g.validator([{name:"required",error:"This field is required.",isValid:A},{name:"email",error:"Please enter a valid email address.",isValid:fa(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)},
{name:"url",error:"Please enter a valid URL.",isValid:fa(/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i)},
{name:"date",error:"Please enter a valid date.",isValid:function(a){return!gc.test((new Date(a)).toString())}},{name:"dateISO",error:"Please enter a valid date (ISO).",isValid:fa(/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/)},{name:"number",error:"Please enter a valid number.",isValid:fa(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/)},{name:"digits",error:"Please enter only digits.",isValid:fa(ub)},{name:"creditcard",error:"Please enter a valid credit card number.",isValid:function(a){if(/[^0-9\-]+/.test(a))return!1;
var b=0,d=0,f=!1;a=a.replace(/\D/g,"");for(var h=a.length-1;0<=h;h--){d=a.charAt(h);d=parseInt(d,10);if(f&&9<(d*=2))d-=9;b+=d;f=!f}return 0===b%10}},{name:"minlength",error:"Please enter at least {minlength} characters.",isValid:function(a,b){return a.length>=b.minlength},initialize:function(a,b,d,f){var h;if(f&&(h=ma.exec(f)))d.options={minlength:+h[1],error:h[3]};else throw"invalid options for minlength validator";},buildError:Q},{name:"maxlength",error:"Please enter no more than {maxlength} characters.",
isValid:function(a,b){return a.length<=b.maxlength},initialize:function(a,b,d,f){var h;if(f&&(h=ma.exec(f)))d.options={maxlength:+h[1],error:h[3]};else throw"invalid options for maxlength validator";},buildError:Q},{name:"rangelength",error:"Please enter a value between {minlength} and {maxlength} characters long.",isValid:function(a,b){return a.length>=b.minlength&&a.length<=b.maxlength},initialize:function(a,b,d,f){var h;if(f&&(h=vb.exec(f)))d.options={minlength:+h[1],maxlength:+h[2],error:h[4]};
else throw"invalid options for rangelength validator";},buildError:Q},{name:"min",error:"Please enter a value greater than or equal to {min}.",isValid:function(a,b){return a>=b.min},initialize:function(a,b,d,f){var h;if(f&&(h=ma.exec(f)))d.options={min:+h[1],error:h[3]};else throw"invalid options for min validator";},buildError:Q},{name:"max",error:"Please enter a value less than or equal to {max}.",isValid:function(a,b){return a<=b.max},initialize:function(a,b,d,f){var h;if(f&&(h=ma.exec(f)))d.options=
{max:+h[1],error:h[3]};else throw"invalid options for max validator";},buildError:Q},{name:"range",error:"Please enter a value between {min} and {max}.",isValid:function(a,b){return a>=b.min&&a<=b.max},initialize:function(a,b,d,f){var h;if(f&&(h=vb.exec(f)))d.options={min:+h[1],max:+h[2],error:h[4]};else throw"invalid options for range validator";},buildError:Q},{name:"equal",error:"Please enter the same value again.",isValid:function(a,b){return p.get(b.comparePath)===a},initialize:function(a,b,
d,f){var h;if(f&&(h=ma.exec(f)))b=a.cd(h[1]).path,d.options={comparePath:b,error:h[3]},a.sub(b,"afterUpdate",function(){this.isEmpty()||q(this.path,this.path,"checkValidity",this.get())});else throw"invalid options for equal validator";}},{name:"regex",error:"Please enter a value match with required pattern.",isValid:function(a,b){return b.regex.test(a)},initialize:function(a,b,d,f){var h;if(f&&(h=hc.exec(f)))d.options={regex:eval(h[1]),error:h[5]};else throw"invalid options for regex validator";
}},{name:"fixedValue",error:'Please enter value "{fixedValue}"',isValid:function(a,b){return a==b.fixedValue},initialize:function(a,b,d,f){if(n(f)){if(a=/^(\w+)(,(.*))*$/.exec(f))d.options={fixedValue:la(a[1]),error:a[3]}}else if(t(f))d.options=f;else{if(k(f))throw"missing options in fixedValue validator";d.options={fixedValue:f}}},buildError:Q}]);var Fb=g.workflowType("v_required").get;k(U)||(F.load=function(a){return U(a+".template")},U.loader.set("template",{load:{compile:function(a,b){j(b).filter("script[id]").each(function(){var a=
j(this);F.compile(this.id,a.html(),a.attr("type")||F.defaultEngine)})},buildDependencies:"parseDependsTag"},url:function(a){return F.templateIdToUrl(U.fileName(a))}}),F.templateIdToUrl=function(a){var b;a.startsWith("*")?(a=a.substr(1),b=a.split("."),a="_",b=b[0]):(b=a.split("."),a=b[0],b=b[1]||"main");return"template/"+a+"/"+b+".html"});g.workflowType({addRowView:da("*getOriginal",function(a,b){var d=this.children();if(0===d.length)this.append(a);else{var f=+b.originalPublisher.pathIndex();0===f?
d.eq(0).before(a):d.eq(f-1).after(a)}}),updateRowView:da("*getOriginal",function(a,b){this.children().eq(+b.originalPublisher.pathIndex()).replaceWith(a)}),removeRowView:function(a){this.children().eq(+a.originalPublisher.pathIndex()).remove()}});J.initQueryable=function(a){function b(){var a=k.ops,b=k.by,f=k.value,h;if(f){if(a)if("equals"==a)h=C("^"+f+"$","i");else throw"operator does not supported";else h=C(f,"i");g=b?function(){return h.test(this[b])}:function(){if(t(this)){for(var a in this)if(h.test(this[a]))return!0;
return!1}return h.test(this)};s.set(!0);d.refreshQuery()}else g&&(g=null,s.set(!1),d.refreshQuery())}if(this.get("*query"))return this;var d,f,h,g,k,l=this.get(),m=this.cd("*query"),n=this.cd("*queryResult"),p=this.cd("*hasQueryResult"),r=m.cd("pager"),q=m.cd("filter"),s=q.cd("enabled"),u=m.cd("sort");(a=!!a)&&n.reference(m.path);n.reference(this.path);this.extend("*",d={autoQuery:a,hasQueryResult:!1,query:{pager:h={enabled:!1,index:0,count:1,size:0},sort:f={by:null,asc:null},filter:k={by:"",value:"",
ops:"",enabled:!1},enabled:function(){return this.get("pager.enabled")||this.get("sort.by")||this.get("filter.enabled")}},queryResult:function(a){var b=j(l),b=g?b.filter(g).get():b.get();p.update(0<b.length);f.by&&b.sortObject(f.by,f.asc);!a&&h.enabled&&(a=Math.ceil(b.length/h.size)||1,a!=h.count&&(h.count=a,h.index>h.count-1&&(h.index=0),m.triggerChange("pager")),b=b.slice(h.index*h.size,(h.index+1)*h.size));return b},refreshQuery:function(){d.autoQuery||T(function(){n.trigger("afterUpdate")},0)},
paging:function(a){a=a.eventData;ub.test(a)?a=+a:"next"==a?a=h.index+1:"previous"==a?a=h.index-1:"first"==a?a=0:"last"==a?a=h.count-1:"disabled"==a&&(a=0,d.resetPaging());if("number"!==typeof a||0>a||a>h.count-1)a=0;r.update("index",a);d.refreshQuery()},resetSort:function(a){u.set("by",null).set("asc",null);!0!==a&&d.refreshQuery()},resetSearch:function(a){q.update("by","").update("value","").update("ops","");!0!==a&&d.refreshQuery()},resetPaging:function(a){r.update("enabled",!1).update("size",0).update("count",
1).update("index",0);!0!==a&&d.refreshQuery()},resetQuery:function(){d.resetSort(!0);d.resetSearch(!0);d.resetPaging(!0);d.refreshQuery()}});q.cd("by").handle("afterUpdate",b);q.cd("value").handle("afterUpdate",b);q.cd("ops").handle("afterUpdate",b);return this};l(g.groups,{listView:"forSelf:.;!afterCreate.1:.|*addRowView;!afterUpdate.1:.|*updateRowView;!afterDel.1:.|*removeRowView",initQueryable:function(a,b,d,f){g(b).initQueryable(!!f)},queryView:"forAll:*queryResult",sortQueryButton:"$click:*query.sort.by|*hardCode;$click:*query.sort.asc|*toggle;$click:*refreshQuery",
resetSortButton:"$click:*resetSort;show:*query.sort.by",searchButton:"$click:*refreshQuery;enable:*query.filter.enabled",resetSearchButton:"$click:*resetSearch;show:*query.filter.enabled",resetQueryButton:"$click:*resetQuery;show:*query.enabled",searchBox:"ns:*query.filter.value;val:.|enter;$esc:.|*null",pager:"forAll:*query.pager;show:*hasQueryResult|_;$paging:*paging;preventDefault:.",setPageButton:"true:*query.pager.enabled;enable:*query.pager.size;$click:*refreshQuery",page:function(a,b,d,f){if(!f)throw"pageIndex is missing";
j(a).mapEvent("click","paging",f)},showFound:"show:*hasQueryResult",hideFound:"hide:*hasQueryResult"});g.table=function(a){k(a)?a=[]:z(a)||(a=[a]);if(a.table&&a.guid)return a;a.table={};a.guid=0;return a};g.onAddOrUpdateNode(function(a,b,d){var f=z(d)&&d.table;if(f){for(var h=0;h<d.length;h++)f["c"+d.guid++]=d[h];a=g(a).cd(b);b=a.cd("table");b.sub(a,"afterCreate.1",Hb);b.sub(a,"afterUpdate.*",Gb);b.sub(a,"afterDel.1",Ib);a.sub(b,"afterDel.1",Jb);a.sub(b,"afterUpdate.1",Kb)}});J.itemKey=function(a){var b,
d;d=this.raw();r(d)&&(d=this.main().get());if(d=d.table)for(b in d)if(a===d[b])return b};J.keyAt=function(a){return this.itemKey(this.get(a))};g.Class.table=function(a){return g.table(this.list(a))};j.Event.prototype.selectedRowIndex=function(){return this.publisher.children().filter(this.originalPublisher.parents()).index()};Ha.prototype={item:null,mode:function(){var a=this.get(),b=a.selectedIndex;return null===a.item?"read":k(b)?"update":-1==b?"new":"update"}};l(J,{initShadowEdit:function(a){var b=
this;if(!b.get("*edit")){var d=b.path,f=C("^"+d.replace(".","\\.")+"\\*edit\\.item[^*]+\\*$"),h=C("^"+d.replace(".","\\.")+"\\*edit\\.item[\\w.]+\\*edit\\.item");if(k(a))if(b.isShadow()&&!r(b.raw())){a=b.main();var g=(a.logicalPath()+"*edit.item").length+1,d=G(d).substr(g);a=ha(a.get("*edit.itemTemplate."+d+".0"),!0)}else a=r(b.raw())?p.raw(b.main().path+"_itemTemplate"):p.raw(d+"_itemTemplate"),k(a)&&(a=Ma(ha(b.get()[0],!0)));d=new Ha(-1);d.itemTemplate=a;d.item=null;b.set("*edit",d);b.cd("*edit.selectedIndex").handle("afterUpdate",
function(a){var d=a.proposed;a=a.removed;0<=d?b.trigger("beginInRowUpdate",d):-1==d&&b.trigger("cancelInRowUpdate",a)});b.cd("*edit.item").handle("afterUpdate",function(){var a,b;for(a in O)if(b=K.toLogicalPath("__hm."+a),h.test(b))delete O[a];else if(f.test(b)&&(b=O[a].edit))b.item=null,b.selectedIndex=-1});return this}},newShadowItem:function(){"read"!==this.get("*edit.mode")&&this.resetShadowItem();var a=this.cd("*edit"),b=a.raw("itemTemplate"),b=r(b)?b():ha(b,!0);a.update("item",b);a.triggerChange("mode")},
editShadowItem:function(a,b){var d=this.raw();if(L(d)||t(d)){var f=this.get("*edit");k(f)&&(f=new Ha,this.set("*edit",f));null===f.item&&(this.set("*edit.item",ha(d,!0)),this.triggerChange("*edit.mode"))}else"read"!==this.get("*edit.mode")&&this.resetShadowItem(),k(b)?b=this.indexOf(a):a=this.get()[b],d=this.cd("*edit"),f=d.raw("itemTemplate"),f=r(f)?f(a):ha(a,!0),d.update("item",f).update("selectedIndex",b),d.triggerChange("mode")},resetShadowItem:function(a){if(this.path.endsWith(".edit.item"))return this.main().resetShadowItem();
var b=this.raw();L(b)||t(b)?(this.set("*edit.item",null),this.triggerChange("*edit.mode")):(b=this.cd("*edit"),k(b.get())||(b.update("item",null),a?b.get().selectedIndex=-1:b.update("selectedIndex",-1),b.triggerChange("mode")))},saveShadowItem:function(){if(this.path.endsWith(".edit.item"))return this.main().saveShadowItem();var a=this.raw();if(L(a)||t(a))this.set(this.get("*edit.item")).set("*edit.item",null),this.triggerChange("*edit.mode");else{var b=this.get("*edit.mode"),d=this.get("*edit.item");
if("read"==b)throw"invalid operations";"new"==b?(r(a)?this.main().push(d):this.push(d),this.resetShadowItem()):(b=this.get("*edit.selectedIndex"),r(a)?(a=this.get(),this.main().replaceItem(a[b],d)):this.replaceItem(a[b],d),this.resetShadowItem(!0))}}});g.workflowType({newShadowItem:"*skipGet newShadowItem",editShadowItem:function(a){"editRow"==a.type?this.editShadowItem(null,a.selectedRowIndex()):this.path.endsWith(".edit.item")?this.main().editShadowItem(this.get()):this.editShadowItem();a.stopPropagation()},
removeItem:function(a){"read"!=this.get("*edit.mode")&&this.resetShadowItem();var b=a.selectedRowIndex(),d=this.raw();r(d)?(d=this.get(),this.main().removeItem(d[b])):this.removeAt(b);a.stopPropagation()},moveUpItem:function(a){var b=a.selectedRowIndex();this.move(b,b-1);a.stopPropagation()},moveDownItem:function(a){var b=a.selectedRowIndex();this.move(b,b+1);a.stopPropagation()},renderNewView:da(function(a){if("new"==a.publisher.get())return a.publisher.main().get("*edit.item")}),renderUpdateRowView:da(function(a){return a.publisher.get("*edit.item")},
function(a,b){this.children().eq(b.proposed).replaceWith(a)}),destroyUpdateRowView:function(a){a.publisher.triggerChange(a.proposed)},saveShadowItem:function(a){this.saveShadowItem();a.stopPropagation()},resetShadowItem:function(a){this.resetShadowItem();a.stopPropagation()}});l(g.groups,{shadowEdit:"!init:.|initShadowEdit *skipSet;deleteRow:.;$editRow:.|*editShadowItem",shadowEditInRow:"shadowEdit:.;!beginInRowUpdate:.|*renderUpdateRowView;!cancelInRowUpdate:.|*destroyUpdateRowView",deleteRow:"$deleteRow:.|*confirm|_Do you want to delete this item?;$deleteRow:.|*removeItem;",
movableRow:"$moveUp:.|*moveUpItem;$moveDown:.|*moveDownItem;",newItemView:"!afterUpdate:*edit.mode|*renderNewView;showOnNew:.",showOnNew:"show:*edit.mode|_new",hideOnNew:"hide:*edit.mode|_new",editItemView:"forSelf:*edit.item;showOnEdit:.",displayItemView:"forSelf:.;hideOnEdit:.",showOnEdit:function(a,b,d){d.appendSub(a,b+"*edit.mode","init afterUpdate",function(a){a=a.publisher.get();this[k(a)||"read"==a?"hide":"show"]()})},hideOnEdit:function(a,b,d){d.appendSub(a,b+"*edit.mode","init afterUpdate",
function(a){a=a.publisher.get();this[k(a)||"read"==a?"show":"hide"]()})},newItem:"$click:.|*newShadowItem;hideOnNew:.",editObject:"$click:.|*editShadowItem;hideOnEdit:.",saveButton:"$click:.|*saveShadowItem",cancelSaveButton:"$click:.|*resetShadowItem"});g.newViewEvent({editRow:["click",function(a){return j(a.target).hasClass("editRow")}],deleteRow:["click",function(a){return j(a.target).hasClass("deleteRow")}],moveUp:["click",function(a){return j(a.target).hasClass("moveUp")}],moveDown:["click",
function(a){return j(a.target).hasClass("moveDown")}]});if(j.bbq){var za=[],wb=j.bbq.getState,ic=j.bbq.pushState,jc=function(a){a=t(a)?G(a.publisher.path):a;var b={};b[a]=p.get(a);ic(b)};g.bookmarkable=function(){var a,b,d=wb(),f={};for(a=0;a<arguments.length;a++)b=arguments[a],b in d&&p.set(b,d[b]),g.sub(null,b,"afterUpdate",jc),za.push(b);for(a=0;a<za.length;a++)b=G(za[a]),f[b]=p.get(b);a=j.param.fragment(nb.href,f);mb.replaceState?mb.replaceState(null,null,a):nb.href=a;return this};J.bookmarkable=
function(a){var b=this;g.bookmarkable.apply(g,j.map(a?arguments:[""],function(a){return b.getPath(a)}));return b};j(x).bind("hashchange",function(){var a=wb(),b;for(b in a)za.contains(b)&&p.set(b,a[b])})}m.selectedClass="selected";m.tabViewAttr="data-tabView";m.tabLinkAttr="data-tabLink";m.tabGroupAttr="data-tabGroup";g.workflowType({highlightTab:function(a){var b=this.attr(m.tabViewAttr)||this.attr(m.tabLinkAttr),d=a.workflow.options||m.selectedClass;a.publisher.get()==b?this.addClass(d):this.removeClass(d)},
highlightTabInContainer:function(a){var b=a.publisher.get(),d=m.tabViewAttr,f=m.tabLinkAttr;a=a.workflow.options;var h=a.selectedClass||m.selectedClass;this.find(a.selector).andSelf().each(function(a,g){var k=j(g);(k.attr(d)||k.attr(f))==b?k.addClass(h):k.removeClass(h)})}});g.groups.tab=function(a,b,d,f){d.appendSub(a,b,"init afterUpdate","*highlightTab",f);j(a).attr(m.tabLinkAttr)&&d.appendSub(b,a,"click",lb,m.tabLinkAttr)};g.groups.tabContainer=function(a,b,d,f){f=(f||"").split(",");var h=m.tabLinkAttr,
g=m.tabGroupAttr,j=f[0]?"["+g+"='"+f[0]+"']":"",g="["+h+"]"+j,j=g+",["+m.tabViewAttr+"]"+j;d.appendSub(b,a,"click",lb,h,g);d.appendSub(a,b,"init100 afterUpdate","*highlightTabInContainer",{selector:j,selectedClass:f[1]})};var W={},kc=/^([^,]+)(,(.+))?$/,xb=/^([^,]+)(,([^,]+))?(,(.+))?$/;g.App=g.Class.extend({bootstrap:function(a,b,d){if(a&&this.loadable()){var f=this,g,k=f.name;na.get(a,k)||(!1!==f.buildRootModel&&(g=f.buildRootModel(b,d)),S(g)?g.done(function(){f.buildRootView(a,b)}):f.buildRootView(a,
b),na.add(a,b,k,f),j(a).bind("shutdown."+k,function(a){f.shutdown(this,a.namespace);a.stopPropagation()}),f.instanceCount++)}},shutdown:function(a,b){var d=this.name;this.destroyRootView(a);this.destroyRootModel(b);na.remove(a,d);j(a).unbind("shutdown."+d);this.instanceCount--},fetchRootData:null,buildRootModel:function(a,b){var d=this;if(!d.fetchRootData)throw"app.fetchRootData is not implemented";var f=d.fetchRootData(a,b);if(S(f))return f.done(function(b){g.set(d.getNamespace(a),b)});g.set(d.getNamespace(a),
f)},destroyRootModel:function(a){!1!==this.buildRootModel&&g(a).del(this.name)},buildRootView:function(a,b){j(a).renderContent(this.getTemplateOptions(),this.getNamespace(b))},destroyRootView:function(a){j(a).empty()},getTemplateOptions:function(){return this.templateOptions||this.name},getNamespace:function(a){return g(a).getPath(this.subPath||this.name)},initialize:function(a){if(!a.name)throw"An app must have a name.";this.callBase("initialize",a)},instanceCount:0,loadable:A,templateOptions:null,
subPath:null},{add:function(a){a instanceof this||(a=this(a));W[a.name]=a},remove:function(a){W[a]&&!W[a].instanceCount&&delete W[a]},get:function(a){return W[a]},bootstrap:function(a,b,d,f){1==arguments.length?(b=R.body,d=""):2==arguments.length&&(b.jquery?(b=b[0],d=""):n(b)&&(d=b,b=R.body,d=""));var g=W[a];if(g)g.bootstrap(b,d,f);else{if(!this.fetch)throw"hm.App.fetch is not implemented";this.fetch(a).done(function(){W[a].bootstrap(b,d,f)})}},shutdown:function(a,b){k(a)&&(a=b,b=R.body);var d=na.get(b,
a);d&&d.app.shutdown(b,d.modelContainer)}});var na={get:function(a,b){return this.appData(a)[b]},add:function(a,b,d,f){this.appData(a)[d]={app:f,modelContainer:b}},remove:function(a,b){delete this.appData(a)[b]},appData:function(a,b){var d=j(a).hmData("app");!b&&!d&&(d={},j(a).hmData("app",d));return d}};l(g.groups,{app:function(a,b,d,f){d=kc.exec(j.trim(f));g.App.bootstrap(d[1],a,b,d[3])},bootstrap:function(a,b,d,f){d=xb.exec(j.trim(f));var h=d[1],k=j(d[3])[0],l=d[5];j(a).click(function(){g.App.bootstrap(h,
k,b,l)})},shutdown:function(a,b,d,f){b=xb.exec(j.trim(f));var h=b[1],k=j(b[3])[0];j(a).click(function(){g.App.shutdown(h,k)})},selfShutdown:function(a,b,d,f){j(a).mapEvent("click","shutdown."+f)}});var lc=j.cleanData;j.cleanData=function(a){j(a).each(function(){var a=na.appData(this,!0);if(a)for(var d in a){var f=a[d];delete a[d];f.unload(this,!0)}});lc(a)};k(U)||(U.loader.set("app","js",{url:"folder"}),g.App.fetch=function(a){return U(a+".app")})})(jQuery,window);
