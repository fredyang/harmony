/*! matrix.js v0.31pre Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */jQuery.Deferred&&function(e,i){function z(a){return function(){for(var c=A.call(arguments),b=0;b<a.length;b++)a[b].apply(this,c)}}function J(a,c){if("string"===typeof a){if(c){for(var b=1,d=k(a);b<d.length;)n(d[b],d[b-1]),b++;a=d[d.length-1]}return U(a)}if(e.isArray(a)){var b=a,m,g=[],f,j={ok:!0};for(m=0;m<b.length;m++)f=b[m],g.push(f),d=0===m?J(f).fail(K(f,j)):d.nextLoad(f).fail(K(g.slice(),j));return u(d)}throw"resource parameter should be an array or string";}function U(a){var c=[],b=k(a);if(1===
b.length)c=L(b[0]);else{for(var d=0;d<b.length;d++)c.push(L(b[d]));c=e.when.apply(e,c)}return u(c).fail(function(){g.unload(a)})}function K(a,c){return function(){c.ok&&(g.unload(a),c.ok=!1)}}function L(a){var c=o(a);if(c){var b=j(a);if(!b){b=c.load(a);if(!b||!b.done)b=e.Deferred().resolve(a,b).promise();c.noRefCount||j(a,b)}"staticLoaded"!==b.refCount&&(b.refCount=b.refCount?b.refCount+1:1);a=b}else a=g(v(a)+".loader").nextLoad(a);return a}function j(a,c){if(a===i)return l;if(c===i){if(1===arguments.length)return l[a];
delete l[a]}else return l[a]=c}function u(a){var c=e.Deferred();a.nextLoad=function(b){var d=A.call(arguments);a.then(function(){g.apply(null,d).then(function(){c.resolve.apply(c,A.call(arguments))},function(){c.reject(b)})},function(){c.reject(b)});return u(c.promise())};a.andLoad=function(){var b=g.apply(null,arguments);return u(e.when(b,a))};return a}function k(a){return a.replace(V,"").split(W)}function M(a){a=N.exec(a.toLowerCase());return!(!a||!(a[1]!=w[1]||a[2]!=w[2]||(a[3]||("http:"===a[1]?
80:443))!=(w[3]||("http:"===w[1]?80:443))))}function x(a){B.href=X.test(a)?a:g.baseUrl+a;M(a)?a=B.href:(a=B.href,a=q(a),a=p?a+(Y.test(a)?"&":"?")+r+"="+p:a);return a}function Z(a){for(var c in a)"string"==typeof a[c]&&(a[c]=h[c][a[c]]);var b=a.staticLoaded||h.staticLoaded.returnFalse,d=a.getSource||h.getSource.getTextByAjax,m=a.compile||h.compile.globalEval,f=a.crossSiteLoad||h.crossSiteLoad.getScript,k=a.buildDependencies||h.buildDependencies.parseRequireTag,l=a.buildUnload||h.buildUnload.parseUnloadTag;
if(!m&&!f)throw"module loader must implement at least one of compile, crossSiteLoad";return function(a){var c=e.Deferred(),h=c.promise(),i;if(b(a))h.refCount="staticLoaded",c.resolve(a);else{i=g.url(a);if(!m||M(i)){if(!f)throw"loader does not support cross domain loading";if((i=f(a))&&i.done)return i;c.resolve(a,i)}else d(a).then(function(b){if(l){var d=l(b,a);d&&(j(a).unload=d)}k&&(d=k(a,b))&&n(a,d);var d=function(){var d=m&&m(a,b);setTimeout(function(){if(!c.dontResolve){c.resolve(a,d);delete h.defer}},
5)},e=n(a);e?g(e).then(d,function(){c.reject(a);delete h.defer}):d()},function(){c.reject(a);delete h.defer});C(c)||(h.defer=c)}return h}}function q(a){return""===p?a:a.replace(O,"")}function P(a,c){var b=e.extend(!0,{},l);g.unload(a,!0);c&&c();return g(a).done(function(){for(var a in b)l[a]&&b[a]&&(l[a].refCount=b[a].refCount,l[a].url=b[a].url,l[a].moduleId=b[a].moduleId)})}function $(a,c){var b,d=(b=o(a))&&b.require&&b.require(a);if(d){b=[];for(var d=k(d),c=k(c),e=0;e<c.length;e++)d.contains(c[e])||
b.push(c[e]);return b.length?b.join():null}return c}function aa(a,c){if(a&&!c||c&&!a)return!0;if(!a&&!c)return!1;a=k(a).sort();c=k(c).sort();if(a.length!=c.length)return!0;for(var b=0;b<a.length;b++)if(a[b]!=c[b])return!0;return!1}function o(a){var c,b;for(b=D.length-1;0<=b&&!(c=D[b](a));b--);c=c||g.defaultLoader;return E[c]}function Q(a,c,b){var d=j(a),e=d.defer;delete d.defer;d.unload=b;e&&e.resolve(a,c())}function R(a){e("<link href='"+g.url(a)+"' rel='stylesheet' type='text/css' loadedByMatrix='1' />").appendTo("head")}
var s={},l={},t={},y={},E={},B=document.createElement("a"),W=/,/,V=/\s+/g,A=[].slice,Y=/\?/,ba=/\.(\w+)$/,ca=/(.+)\.\w+$/,v,S,F,h,n,X=/^http[s]?:\/\/|^\//,N=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,w=N.exec(location.href.toLowerCase())||[],p="",r="v",O,G=[],H=[],I=[],f=Array.prototype,D,T={},g=window.matrix=function(a,c,b){"boolean"!==typeof a&&(b=c,c=a,a=!1);if(c)return a=a&&!e.isReady,c=J(c,b),a&&(e.holdReady(!0),c.done(function(){e.holdReady()})),c.done(da).fail(ea)};f.indexOf=f.indexOf||
function(a,c){for(var b=c||0;b<this.length;b++)if(this[b]==a)return b;return-1};f.contains=f.contains||function(a){return-1!==this.indexOf(a)};f.remove=f.remove||function(a){a=this.indexOf(a);-1!=a&&this.splice(a,1);return this};f.pushUnique=f.pushUnique||function(a){this.contains(a)||this.push(a);return this};f.merge=f.merge||function(a){if(a&&a.length)for(var c=0;c<a.length;c++)this.pushUnique(a[c]);return this};var ea=z(H),da=z(G),fa=z(I),C=e.Deferred().isResolved?function(a){return a.isResolved()}:
function(a){return"resolved"==a.state()};e.extend(g,{unload:function(a,c){var b,d;if(e.isFunction(a))c?I.remove(a):I.push(a);else if("string"===typeof a&&(a=k(a)),1!=a.length)for(b=0;b<a.length;b++)g.unload(a[b]);else if(b=a[0],(d=j(b))&&"staticLoaded"!=d.refCount){if(0===--d.refCount||c)(d=d.unload||o(b).unload)&&d(b),j(b,i),(b=n(b))&&g.unload(b,c);fa()}},url:function(a,c){if("object"===typeof a)for(var b in a)g.url(b,a[b]);else if(c===i){if(1==arguments.length)return s[a]?s[a]:(b=o(a))&&b.url?x(b.url(a)):
x(b&&b.fileExt?S(a)+"."+b.fileExt:a);delete s[a]}else{b=g.url(a);var d=x(c);b!=d&&((b=j(a))&&C(b)?P(a,function(){s[a]=d}):s[a]=d)}},require:n=function(a,c){if("object"===typeof a)for(var b in a)a.hasOwnProperty(b)&&n(b,a[b]);else if(c===i){if(1==arguments.length){b=t[a];var d=o(a);return d&&d.require?(d=d.require(a))&&b?d+","+b:d?d:b:b}delete t[a]}else if(!0===c){if(b=(b=n(a))&&k(b)){for(var d=[],e=0;e<b.length;e++)"module"!==g.fileExt(b[e])&&d.pushUnique(g.url(b[e])),d.merge(n(b[e],!0));return d}}else{var f=
$(a,c);b=t[a];aa(f,b)&&(d=j(a),b&&d&&C(d)?P(a,function(){t[a]=f}):t[a]=f)}},baseUrl:"",hash:function(a,c){arguments.length&&(p=!0===a?e.now():a,r=c!==i?c:r||"v",O=RegExp("[?&]"+r+"=[^&]*"));return""===p?"":r+"="+p},loader:{resolveDependencies:function(a){return function(c){var b=e.Deferred(),d=g.require(c);d?g(d).done(function(){b.resolve(c,a(c))}):b.resolve(c,a(c));return b.promise()}},set:function(a,c,b){"string"!==typeof c&&(b=c,c=null);var b=y[a]=e.extend(!0,{},y[c],b),d=e.extend(!0,{},b);e.each(["load",
"unload","url","require"],function(){var a;if(typeof d[this]=="string"&&(a=F[this][d[this]]))d[this]=a});e.isPlainObject(d.load)&&(d.load=Z(d.load));if(!e.isFunction(d.load))throw"missing load function from loader";E[a]=e.extend({},E[c],d)},get:function(a){return a?y[a]:y},commands:F={load:{},unload:{},url:{},require:{}},finders:D=[function(a){return v(a)},function(a){a=v(a);if(a=T[a])return a}],mapFileExtsToLoader:function(a,c){for(var a=k(a),b=0;b<a.length;b++)T[a[b]]=c},loadFilters:h={staticLoaded:{},
getSource:{},compile:{},crossSiteLoad:{},buildUnload:{},buildDependencies:{}}},fileExt:v=function(a){return ba.exec(a)[1]},fileName:S=function(a){return ca.exec(a)[1]},define:function(a,c,b,d){e.isFunction(c)&&(d=b,b=c,c=null);var f=j(a);if(!f){var h=e.Deferred(),f=h.promise();f.defer=h;j(a,f)}f.defer.dontResolve=!0;if(c)return n(a,c),g(c).done(function(){Q(a,b,d)});Q(a,b,d)},done:function(a,c){c?G.remove(a):G.push(a)},fail:function(a,c){c?H.remove(a):H.push(a)},defaultLoader:"js"});var f=g.loader.set,
ga=/<@unload>([\w\W]+?)<\/@unload>/i,ha=/<@require>([\w\W]+?)<\/@require>/i;e.extend(!0,F,{load:{cacheImage:function(a){var c=e.Deferred(),b=c.promise(),d=g.url(a),f=new Image,f=new Image;f.onload=function(){c.resolve(a,d)};f.onerror=function(){c.reject(a,d)};f.src=d;return b}},unload:{removeCssLinkTag:function(a){var c=x(g.url(a));e("link").filter(function(){return this.href===c&&e(this).attr("loadedByMatrix")}).remove()}},url:{moduleId:function(a){return a},folder:function(a){var c=o(a).fileExt,
c=c?g.fileName(a)+"."+c:a;return g.fileExt(a)+"/"+c}}});e.extend(!0,h,{staticLoaded:{returnFalse:function(){return false},hasScriptTag:function(a){return!!e("script").filter(function(){return q(this.src)===q(g.url(a))}).length},hasCssLinkTag:function(a){return!!e("link").filter(function(){return q(this.href)===q(g.url(a))&&!e(this).attr("loadedByMatrix")}).length}},getSource:{getTextByAjax:function(a){return e.ajax({url:g.url(a),dataType:"text",cache:true})}},compile:{globalEval:function(a,c){return e.globalEval(c)},
localEval:function(a,c){return eval(c)},linkCss:R},crossSiteLoad:{getScript:function(a){var c=e.Deferred(),b=c.promise();b.defer=c;e.getScript(g.url(a)).then(function(){setTimeout(function(){if(!c.dontResolve){c.resolve(a);delete b.defer}},5)},function(){c.reject(a);delete b.defer});return b},linkCss:R},buildUnload:{parseUnloadTag:function(a){return(a=ga.exec(a))&&a[1]&&new Function(a[1])}},buildDependencies:{parseRequireTag:function(a,c){var b=ha.exec(c);return b&&b[1]||null}}});f("pack",{load:g.loader.resolveDependencies(e.noop),
url:"moduleId"});f("js",{load:{staticLoaded:"hasScriptTag"},fileExt:"js"});f("loader","js",{url:"folder"});f("css",{load:{staticLoaded:"hasCssLinkTag",crossSiteLoad:"linkCss",compile:"linkCss",buildDependencies:"parseRequireTag"},unload:"removeCssLinkTag",fileExt:"css"});f("image",{load:"cacheImage",noRefCount:!0});g.loader.mapFileExtsToLoader("jpg,png,bmp,gif","image")}(jQuery);
