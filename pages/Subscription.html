<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Unified Subscription</title>
	<script src="../ref/modernizr-2.6.2.min.js"></script>
	<link href="doc.css" rel='stylesheet'/>

</head>
<body>
<!--[if lt IE 7]>
<p class="chrome">You are using an <strong>outdated</strong> browser. Please <a
	href="http://browsehappy.com/">upgrade your browser</a> or <a
	href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to
	improve your experience.</p>
<![endif]-->
<div class="page fixedHead">
<div class="head  title NoTop">
	<header>
		<h1><a class="linkButton" href="../index.html">Harmony</a></h1>

		<p>where model and view should live in</p>
	</header>

	<nav class="hlist">
		<a href="../index.html" class="selected">Home</a>

		<a href="doc.html">Documentation</a>
		<a href="//github.com/fredyang/Harmony">Source on GitHub</a>
	</nav>

</div>

<div class="transition">
</div>

<div class="body">
	<div class="leftCol">

		<div class="mod  ">
			<div class="hd">
				Introduction
			</div>

			<div class="bd">
				<nav class="vlist">
					<a href="../index.html">Get started</a>
					<a href="Repository.html">Repository</a>
					<a href="Subscription.html">Unified Subscription</a>
					<a href="workflowActivity.html">Workflow/activity</a>
					<a href="template.html">Template</a>
					<a href="examples.html">Examples</a>
				</nav>
			</div>
		</div>


	</div>

	<div class="main">

		<h2>Unified Subscription</h2>
		<!--	<p>But before that, let's talk about briefly about <a
				href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">
				Publish–subscribe pattern</a>, because this is the foundation of the whole library.
				Here is its definition in
				Wiki.
			</p>

			<blockquote>
				In software architecture, publish–subscribe is a messaging pattern where senders of
				messages, called publishers, do not program the messages to be sent directly to
				specific receivers, called subscribers. Instead, published messages are
				characterized into classes, without knowledge of what, if any, subscribers there may
				be. Similarly, subscribers express interest in one or more classes, and only receive
				messages that are of interest, without knowledge of what, if any, publishers there
				are.
			</blockquote>-->
		<p>There are two ways to handle events, event subscription and event binding.
			Their differences are subtle but important.
		</p>

		<ol class="list">
			<li>A event subscription has two objects, publisher and subscriber, while event
				binding has only publisher and no subscriber.
			</li>
			<li>
				When target event happens, the handler of event binding tends to control
				arbitrary things which may or may not be in conflict with each others, because there is
				not subscriber. When target event happens, the handler of event subscriptions, the
				subscriber tends to do very specific things which affect himself, there will be no
				conflict, so there is no need to to "synchronize".
			</li>
			<li>The publisher of a subscription does not need to keep track of
				event handler, while publisher of event binding holds a list of event handlers.
			</li>
		</ol>
		<p>
			Harmony use event subscription to implement the publish-subscribe pattern.

			A typical subscriptions include the following steps.</p>

		<ol class="list">
			<li>A subscriber use Harmony to register a subscription for a event of a publisher
				with
				a handler workflow. As a result of the registration, Harmony keep a record like
				the
				following:
<pre data-sub="prettyprint:_">
var x = {
 publisher: publisher,
 subscriber: subscriber,
 event: event,
 handler: workflow
};
</pre>
			</li>
			<li>Publisher trigger the event.</li>
			<li>Harmony find all that record x is a match. It execute the workflow like
				the following:
<pre data-sub="prettyprint:_">
executeWorkflow(x.workflow, x.publisher, x.subscriber, x.event);
</pre>

			</li>
		</ol>

		<p>
			The third step is interesting, which is result of the differences mentioned above.
		</p>

		<p>
			Firstly, because publisher does not keep record of subscription, it can not notify
			the
			subscriber. The notification is handled by Harmony. If publisher is a model, this
			means
			that a model is more light-weight, because it does not have the burden to keep track
			of
			its subscriptions.</p>

		<p>
			Secondly, the workflow object is not executing itself, instead it s executed by
			Harmony
			workflow executor. The workflow does not know either publisher or subscriber, the
			workflow executor introduce them to workflow when it is executed. This
			make the <a href="/harmony/doc/workflowActivity.html">workflow</a>
			stateless, and very
			reusable.
		</p>

		<p>The reason it is called <strong>Unified Subscription</strong> is that,

			both publisher and subscriber can be model (model node) or view (jQuery object or
			DOM
			element), and the event can be either model event or view event (DOM event or jQuery
			event).
		</p>


		<h3>Programmatic Subscription</h3>

		<p>
			The third step is taken care by Harmony, we are mostly responsible for step 1
			(subscription registration), and sometimes step 2 (event triggering). The
			follow examples show to how to do subscription registration. The first example shows
			programmatic subscriptions.
		</p>


<pre data-sub="prettyprint:_;preview:_|http://jsbin.com/inicoh/1">

var customer = hm("customer", {
 firstName: "",
 lastName: "",
 fullName: function () { /* implementation */ }
});

//model firstName subscribe view "#txtFirstName"'s event
customer.cd("firstName").sub("$#txtFirstNmae", "change", function (e) {
 this.set(e.publisher.val());
});

//model lastName subscribe view "#txtLastName"'s event
customer.cd("lastName").sub("$#txtLastName", "change", function (e) {
  this.set(e.publisher.val());
});

//view lblFullName subscribe mode "customer.fullName"'s event
$("#lblFullName").sub(customer.cd("fullName"), "afterUpdate",
  function (e) {
   this.text(e.publisher.get());
});
</pre>
		<h3>Declarative Subscription</h3>

		<p> The follow is the declarative registration of subscriptions of the previous example.
			Declarative subscription is really doing the same thing of programmatic
			subscription,
			but just differently.
		</p>

<pre data-sub="prettyprint:_;preview:_|http://jsbin.com/atuzug/1">

&lt;div data-sub="ns:customer"&gt;
&lt;div&gt;First Name: &lt;input data-sub="val:firstName" type="text" /&gt;&lt;/div&gt;
&lt;div&gt;Last Name: &lt;input data-sub="val:lastName" type="text" /&gt;&lt;/div&gt;
&lt;div&gt;Full Name: &lt;span data-sub="text:fullName"&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
</pre>

	</div>

</div>
<div class="footer   title">
	<p class="fR man">&copy; Fred Yang - <a href="http://semanticsworks.com">http://semanticsworks.com</a>
	</p>
</div>
</div>
</div>
<script src="../ref/jquery.js"></script>
<script src="../ref/jsrender.js"></script>
<script src="../ref/jquery.ba-bbq.min.js"></script>
<script src="../download/harmony.debug.js"></script>
<script src="../ref/matrix.min.js"></script>
<script src="../assets/js/doc.js"></script>

</body>
</html>